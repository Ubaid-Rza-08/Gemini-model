<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KrishiMitra - Smart Crop Advisory</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary: #2e7d32;
            --secondary: #4caf50;
            --accent: #66bb6a;
            --dark: #1b5e20;
            --light: #f1f8e9;
            --text: #333;
            --shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--text);
            background-color: #fafafa;
            padding-top: 80px; /* Account for fixed header */
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .section-title {
            text-align: center;
            margin-bottom: 50px;
        }

        .section-title h2 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: var(--dark);
        }

        .section-title p {
            font-size: 1.1rem;
            color: #666;
        }

        /* Button Styles */
        .btn {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
            box-shadow: var(--shadow);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(46, 125, 50, 0.3);
            background: linear-gradient(135deg, var(--secondary) 0%, var(--accent) 100%);
        }

        .btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #757575 0%, #9e9e9e 100%);
        }

        .btn-secondary:hover {
            background: linear-gradient(135deg, #616161 0%, #757575 100%);
        }

        .btn-toggle {
            background: #f5f5f5;
            color: var(--text);
            border: 2px solid #ddd;
            margin: 5px;
        }

        .btn-toggle.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* Header */
        /* Header */
        header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 12px 0;
            box-shadow: var(--shadow);
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 1000;
            justify-content: center;
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .logo {
            display: flex;
            align-items: center;
            font-size: 1.6rem;
            font-weight: bold;
            white-space: nowrap;
        }

        .logo i {
            margin-right: 8px;
            font-size: 1.8rem;
        }

        nav {
            flex: 1;
            display: flex;
            justify-content: center;
        }

        nav ul {
            display: flex;
            list-style: none;
            align-items: center;
            gap: 8px;
            margin: 0;
            padding: 0;
        }

        nav a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            padding: 8px 12px;
            border-radius: 18px;
            white-space: nowrap;
            display: block;
        }

        nav a:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-1px);
        }

        /* Auth Overlay */
        .auth-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(46, 125, 50, 0.9) 0%, rgba(76, 175, 80, 0.9) 100%);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            padding: 20px;
        }

        .auth-form {
            background: white;
            padding: 40px;
            border-radius: 15px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            position: relative;
        }

        .auth-form h2 {
            text-align: center;
            margin-bottom: 30px;
            color: var(--primary);
            font-size: 1.8rem;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text);
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: var(--primary);
        }

        .auth-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .auth-buttons .btn {
            flex: 1;
            text-align: center;
        }

        .auth-switch {
            text-align: center;
            margin-top: 20px;
            color: #666;
        }

        .auth-switch a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 600;
        }

        .auth-switch a:hover {
            text-decoration: underline;
        }

        .error-message, .success-message {
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
            text-align: center;
        }

        .error-message {
            background-color: #ffebee;
            color: #d32f2f;
            border: 1px solid #ffcdd2;
        }

        .success-message {
            background-color: #e8f5e8;
            color: #2e7d32;
            border: 1px solid #c8e6c9;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            color: white;
        }

        .logout-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 6px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .logout-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Page Styles */
        .page {
            display: none;
            padding: 60px 0;
        }

        .page.active {
            display: block;
        }

        /* Farming Equipment Page Styles */
        .equipment-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        .equipment-header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .equipment-header h2 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            color: var(--dark);
        }

        .equipment-header p {
            font-size: 1.2rem;
            color: #666;
            margin-bottom: 2rem;
        }

        .stats {
            background: linear-gradient(135deg, rgba(46, 125, 50, 0.1) 0%, rgba(76, 175, 80, 0.1) 100%);
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 2rem;
            text-align: center;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 2rem;
        }

        .stat-item h3 {
            font-size: 2.5rem;
            color: var(--primary);
            margin-bottom: 0.5rem;
            font-weight: bold;
        }

        .stat-item p {
            color: #666;
            font-size: 1rem;
            font-weight: 500;
        }

        .search-filter {
            background: linear-gradient(135deg, rgba(46, 125, 50, 0.05) 0%, rgba(76, 175, 80, 0.05) 100%);
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            align-items: center;
            border: 2px solid rgba(46, 125, 50, 0.1);
        }

        .search-box {
            flex: 1;
            min-width: 250px;
            padding: 0.8rem 1rem;
            border: 2px solid rgba(46, 125, 50, 0.3);
            border-radius: 10px;
            background: white;
            color: var(--text);
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .search-box:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(46, 125, 50, 0.1);
        }

        .filter-btn {
            background: rgba(46, 125, 50, 0.1);
            border: 2px solid rgba(46, 125, 50, 0.3);
            color: var(--primary);
            padding: 0.8rem 1.2rem;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .filter-btn:hover, .filter-btn.active {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(46, 125, 50, 0.3);
        }

        .equipment-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 2rem;
            margin-top: 1rem;
        }

        .equipment-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            border-radius: 20px;
            padding: 2rem;
            transition: all 0.4s ease;
            cursor: pointer;
            border: 2px solid rgba(46, 125, 50, 0.1);
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        }

        .equipment-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(76, 175, 80, 0.1), transparent);
            transition: left 0.6s;
        }

        .equipment-card:hover::before {
            left: 100%;
        }

        .equipment-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 40px rgba(46, 125, 50, 0.15);
            border-color: var(--primary);
        }

        .equipment-image {
            width: 100%;
            height: 160px;
            background: linear-gradient(135deg, var(--light) 0%, rgba(76, 175, 80, 0.1) 100%);
            border-radius: 15px;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
            position: relative;
            overflow: hidden;
            border: 2px solid rgba(46, 125, 50, 0.1);
        }

        .equipment-info h3 {
            font-size: 1.4rem;
            margin-bottom: 0.8rem;
            color: var(--dark);
            font-weight: 600;
        }

        .equipment-price {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 0.8rem;
        }

        .equipment-desc {
            font-size: 0.95rem;
            color: #666;
            margin-bottom: 1.5rem;
            line-height: 1.5;
        }

        .view-details-btn {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            width: 100%;
        }

        .view-details-btn:hover {
            background: linear-gradient(135deg, var(--secondary) 0%, var(--accent) 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(46, 125, 50, 0.3);
        }

        /* Hero Section */
        .hero {
            background: linear-gradient(rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.6)), url('https://images.unsplash.com/photo-1625246336722-891c9e127978?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80');
            background-size: cover;
            background-position: center;
            color: white;
            padding: 100px 0;
            text-align: center;
        }

        .hero-content {
            max-width: 800px;
            margin: 0 auto;
        }

        .hero h2 {
            font-size: 2.5rem;
            margin-bottom: 20px;
        }

        .hero p {
            font-size: 1.2rem;
            margin-bottom: 30px;
        }

        /* Features Section */
        .features {
            padding: 80px 0;
            background-color: white;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
        }

        .feature-card {
            background-color: var(--light);
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            box-shadow: var(--shadow);
            transition: transform 0.3s ease;
        }

        .feature-card:hover {
            transform: translateY(-10px);
        }

        .feature-icon {
            background-color: var(--primary);
            color: white;
            width: 70px;
            height: 70px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 1.8rem;
        }

        .feature-card h3 {
            margin-bottom: 15px;
            color: var(--dark);
        }

        /* Analysis Method Toggle */
        .method-toggle {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
        }

        .method-toggle h4 {
            margin-bottom: 15px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .toggle-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        /* How It Works */
        .how-it-works {
            padding: 80px 0;
            background-color: #f0f7f0;
        }

        .steps {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            margin-top: 50px;
        }

        .step {
            flex: 1;
            min-width: 250px;
            text-align: center;
            padding: 20px;
            position: relative;
        }

        .step-number {
            width: 50px;
            height: 50px;
            background-color: var(--secondary);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
            margin: 0 auto 20px;
        }

        /* Advisory Tool */
        .advisory-tool {
            padding: 80px 0;
            background-color: white;
        }

        .tool-container {
            background-color: var(--light);
            border-radius: 10px;
            padding: 30px;
            box-shadow: var(--shadow);
            max-width: 800px;
            margin: 0 auto;
        }

        .result {
            margin-top: 30px;
            padding: 20px;
            background-color: white;
            border-radius: 5px;
            border-left: 4px solid var(--secondary);
            display: none;
        }

        .analysis-result {
            margin-top: 20px;
            padding: 20px;
            background: linear-gradient(135deg, #f0f7f0 0%, #e8f5e8 100%);
            border-radius: 10px;
            border-left: 4px solid var(--primary);
        }

        .analysis-result h4 {
            color: var(--primary);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .fertilizer-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            border: 1px solid #ddd;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
        }

        .fertilizer-card:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .fertilizer-card h6 {
            color: var(--dark);
            margin-bottom: 8px;
            font-size: 1.1rem;
        }

        .recommendation-section {
            margin: 15px 0;
        }

        .recommendation-section h5 {
            color: var(--primary);
            margin-bottom: 10px;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .recommendation-section ul {
            list-style: none;
            padding-left: 0;
        }

        .recommendation-section ul li {
            padding: 8px 0;
            position: relative;
            padding-left: 25px;
            line-height: 1.5;
        }

        .recommendation-section ul li:before {
            content: "âœ“";
            position: absolute;
            left: 0;
            color: var(--primary);
            font-weight: bold;
        }

        .waiting-message {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            border-left: 5px solid #2196f3;
            margin: 20px 0;
            box-shadow: 0 4px 12px rgba(33, 150, 243, 0.1);
        }

        .processing-steps {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
            flex-wrap: wrap;
            gap: 15px;
        }

        .processing-step {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            flex: 1;
            min-width: 150px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .processing-step i {
            font-size: 1.5rem;
            color: var(--primary);
            margin-bottom: 8px;
        }

        .pulse-animation {
            animation: pulse 1.5s ease-in-out infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .image-preview {
            margin-top: 15px;
            text-align: center;
        }

        .image-preview img {
            max-width: 100%;
            max-height: 200px;
            border-radius: 8px;
            border: 2px solid #ddd;
        }

        .image-preview .remove-image {
            display: block;
            margin-top: 10px;
            background: #f44336;
            color: white;
            border: none;
            padding: 5px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
        }

        /* Testimonials */
        .testimonials {
            padding: 80px 0;
            background-color: #f0f7f0;
        }

        .testimonial-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-top: 50px;
        }

        .testimonial-card {
            background-color: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: var(--shadow);
        }

        .testimonial-text {
            font-style: italic;
            margin-bottom: 20px;
        }

        .testimonial-author {
            display: flex;
            align-items: center;
        }

        .author-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            margin-right: 15px;
        }

        /* Chatbot Styles */
        .chat-message {
            margin-bottom: 20px;
            display: flex;
            align-items: flex-start;
        }

        .chat-message.user-message {
            flex-direction: row-reverse;
        }

        .message-content {
            max-width: 70%;
            padding: 12px 16px;
            border-radius: 18px;
            line-height: 1.4;
            word-wrap: break-word;
        }

        .bot-message .message-content {
            background-color: #f0f7f0;
            border-bottom-left-radius: 4px;
        }

        .user-message .message-content {
            background-color: var(--primary);
            color: white;
            border-bottom-right-radius: 4px;
        }

        .typing-indicator {
            display: none;
            padding: 12px 16px;
            background-color: #f0f7f0;
            border-radius: 18px;
            border-bottom-left-radius: 4px;
            margin-bottom: 15px;
            color: #666;
        }

        .typing-dots {
            display: inline-block;
        }

        .typing-dots:after {
            content: '';
            animation: dots 1.5s steps(5, end) infinite;
        }

        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60% { content: '...'; }
            80%, 100% { content: ''; }
        }

        .language-selector {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 2px solid #e0e0e0;
        }

        .language-selector h4 {
            color: var(--primary);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Fixed Weather Widget Styles */
        #floating-weather {
            position: fixed;
            top: 80px;
            right: 20px;
            background: linear-gradient(135deg, #2e7d32 0%, #4caf50 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(46, 125, 50, 0.3);
            min-width: 220px;
            font-size: 0.9rem;
            z-index: 2000;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }

        #floating-weather:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(46, 125, 50, 0.4);
            background: linear-gradient(135deg, #388e3c 0%, #66bb6a 100%);
        }

        #floating-weather h4 {
            margin: 0 0 15px 0;
            font-size: 1.1rem;
            text-align: center;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        #floating-weather-content {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        #floating-weather-content p {
            margin: 0;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.95rem;
            background: rgba(255, 255, 255, 0.1);
            padding: 8px 12px;
            border-radius: 8px;
            transition: background 0.3s ease;
        }

        #floating-weather-content p:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        #floating-weather-content i {
            width: 16px;
            text-align: center;
            color: rgba(255, 255, 255, 0.9);
        }

        .weather-city {
            font-size: 1rem;
            font-weight: 600;
            text-align: center;
            margin-bottom: 10px;
            padding: 5px 10px;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 8px;
            letter-spacing: 0.5px;
        }

        .weather-loading {
            text-align: center;
            padding: 15px;
            color: rgba(255, 255, 255, 0.8);
            font-style: italic;
        }

        .weather-error {
            text-align: center;
            padding: 10px;
            color: #ffcdd2;
            font-size: 0.85rem;
            background: rgba(244, 67, 54, 0.1);
            border-radius: 8px;
            margin-top: 10px;
        }

        /* Footer */
        footer {
            background-color: var(--dark);
            color: white;
            padding: 50px 0 20px;
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 40px;
            margin-bottom: 30px;
        }

        .footer-column h3 {
            margin-bottom: 20px;
            font-size: 1.2rem;
        }

        .footer-column ul {
            list-style: none;
        }

        .footer-column ul li {
            margin-bottom: 10px;
        }

        .footer-column a {
            color: #ccc;
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .footer-column a:hover {
            color: white;
        }

        .social-links {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .social-links a {
            display: inline-block;
            width: 40px;
            height: 40px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .social-links a:hover {
            background-color: var(--accent);
            transform: translateY(-3px);
        }

        .copyright {
            text-align: center;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 0.9rem;
            color: #ccc;
        }

        /* AGMARKNET Styles Integration */
        .agmarknet-header {
            background: linear-gradient(to bottom, #87CEEB, #4682B4);
            padding: 5px 10px;
            border-bottom: 3px solid #2E8B57;
            margin: -60px -20px 20px -20px;
            border-radius: 0 0 10px 10px;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: white;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 10px;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .agmarknet-logo {
            width: 150px;
            height: 60px;
            background: linear-gradient(45deg, #2E8B57, #228B22);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            border: 2px solid #FFD700;
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 12px;
        }

        .navigation {
            background: linear-gradient(to right, #4682B4, #1E90FF);
            padding: 0;
            border-radius: 5px;
        }

        .nav-items {
            display: flex;
            list-style: none;
        }

        .nav-items li {
            position: relative;
        }

        .nav-items a {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            color: white;
            text-decoration: none;
            font-size: 13px;
            font-weight: bold;
            border-right: 1px solid rgba(255,255,255,0.3);
        }

        .nav-items a:hover {
            background: rgba(255,255,255,0.2);
        }

        .nav-icon {
            width: 16px;
            height: 16px;
            margin-right: 8px;
            background: white;
            border-radius: 2px;
        }

        .search-bar {
            background: white;
            padding: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            border-radius: 5px;
            margin: 10px 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .search-controls {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
        }

        .search-controls select, .search-controls input {
            padding: 5px 8px;
            border: 1px solid #ccc;
            border-radius: 3px;
            font-size: 11px;
        }

        .search-btn {
            background: #228B22;
            color: white;
            padding: 6px 15px;
            border: none;
            border-radius: 3px;
            font-weight: bold;
            cursor: pointer;
        }

        .search-btn:hover {
            background: #1e7b1e;
        }

        .content-area {
            display: flex;
            gap: 15px;
            padding: 15px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .sidebar {
            width: 200px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            height: fit-content;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .sidebar-item {
            display: block;
            padding: 12px 15px;
            color: #333;
            text-decoration: none;
            border-bottom: 1px solid #eee;
            font-size: 13px;
            background: white;
        }

        .sidebar-item:hover, .sidebar-item.active {
            background: #f0f8ff;
        }

        .sidebar-icon {
            width: 16px;
            height: 16px;
            display: inline-block;
            background: #4682B4;
            border-radius: 2px;
            margin-right: 8px;
            vertical-align: middle;
        }

        .main-content {
            flex: 1;
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .dashboard-header {
            background: linear-gradient(to right, #2E8B57, #228B22);
            color: white;
            padding: 10px 15px;
            margin: -20px -20px 20px -20px;
            font-weight: bold;
        }

        .dashboard-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .chart-container {
            background: #f8f9fa;
            border: 2px solid #2E8B57;
            border-radius: 5px;
            overflow: hidden;
        }

        .chart-header {
            background: #2E8B57;
            color: white;
            padding: 8px 12px;
            font-size: 13px;
            font-weight: bold;
        }

        .chart-content {
            padding: 15px;
            height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .bar-chart {
            display: flex;
            align-items: end;
            height: 150px;
            gap: 8px;
        }

        .bar {
            background: linear-gradient(to top, #1E90FF, #87CEEB);
            width: 20px;
            border-radius: 2px 2px 0 0;
        }

        .line-chart {
            width: 100%;
            height: 150px;
            background: linear-gradient(45deg, transparent 49%, #1E90FF 49%, #1E90FF 51%, transparent 51%);
            position: relative;
        }

        .trend-line {
            position: absolute;
            bottom: 20px;
            left: 10px;
            right: 10px;
            height: 2px;
            background: #FF6B35;
            transform: rotate(15deg);
            transform-origin: left;
        }

        .right-sidebar {
            width: 280px;
        }

        .mandi-prices {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 15px;
        }

        .mandi-header {
            background: linear-gradient(to right, #FF6B35, #FF8C42);
            color: white;
            padding: 12px 15px;
            font-weight: bold;
        }

        .mandi-content {
            padding: 15px;
        }

        .price-ticker {
            background: #2E8B57;
            color: white;
            padding: 8px 12px;
            margin: -15px -15px 15px -15px;
            font-size: 12px;
        }

        .commodity-list {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .commodity-header {
            background: #2E8B57;
            color: white;
            padding: 10px 15px;
            font-weight: bold;
            text-align: center;
        }

        .commodity-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 15px;
            border-bottom: 1px solid #eee;
            font-size: 12px;
            cursor: pointer;
        }

        .commodity-item:hover {
            background: #f0f8ff;
        }

        .plus-icon {
            color: #228B22;
            font-weight: bold;
            transition: transform 0.3s ease;
        }

        .plus-icon.expanded {
            transform: rotate(45deg);
        }

        .search-results {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: none;
        }

        .search-results.show {
            display: block;
        }

        .search-results-header {
            background: linear-gradient(to right, #2E8B57, #228B22);
            color: white;
            padding: 10px 15px;
            margin: -20px -20px 20px -20px;
            font-weight: bold;
            border-radius: 8px 8px 0 0;
        }

        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .results-table th, .results-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
            font-size: 12px;
        }

        .results-table th {
            background: #f8f9fa;
            font-weight: bold;
        }

        .results-table tr:hover {
            background: #f5f5f5;
        }

        .no-data {
            text-align: center;
            padding: 40px;
            color: #666;
            font-size: 16px;
        }

        .ticker-text {
            white-space: nowrap;
            animation: scroll 30s linear infinite;
        }

        @keyframes scroll {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }

        .stats-info {
            background: #e6f3ff;
            padding: 10px;
            border-radius: 5px;
            font-size: 11px;
            color: #333;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            body {
                padding-top: 120px; /* More space for mobile header */
            }

            .header-content {
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }

            nav ul {
                flex-direction: column;
                gap: 10px;
            }

            .hero h2 {
                font-size: 2rem;
            }

            .steps {
                flex-direction: column;
                gap: 40px;
            }

            .mobile-menu-btn {
                display: block;
                position: absolute;
                top: 15px;
                right: 20px;
            }

            .nav-menu {
                display: none;
                width: 100%;
                margin-top: 15px;
            }

            .nav-menu.active {
                display: block;
            }

            .auth-form {
                margin: 20px;
                padding: 30px 20px;
            }

            .processing-steps {
                flex-direction: column;
            }

            #floating-weather {
                top: 130px;
                right: 10px;
                min-width: 200px;
                font-size: 0.85rem;
            }

            .toggle-buttons {
                justify-content: center;
            }

            .content-area {
                flex-direction: column;
                padding: 10px;
            }
            
            .sidebar, .right-sidebar {
                width: 100%;
            }
            
            .dashboard-content {
                grid-template-columns: 1fr;
            }
            
            .nav-items {
                flex-wrap: wrap;
            }
            
            .search-controls {
                flex-direction: column;
                align-items: stretch;
            }

            /* Equipment page mobile styles */
            .equipment-container {
                padding: 1rem;
            }
            
            .equipment-grid {
                grid-template-columns: 1fr;
            }
            
            .equipment-header h2 {
                font-size: 2rem;
            }
            
            .search-filter {
                flex-direction: column;
                align-items: stretch;
            }

            .search-box {
                min-width: auto;
            }

            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                gap: 1rem;
            }

            .stat-item h3 {
                font-size: 2rem;
            }
        }

        .loading {
            opacity: 0.5;
            pointer-events: none;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .equipment-card {
            animation: fadeIn 0.6s ease forwards;
        }
    </style>
</head>
<body>
<!-- Authentication Overlay -->
<div id="auth-overlay" class="auth-overlay" style="display: flex;">
    <!-- Login Form -->
    <div id="login-form" class="auth-form">
        <h2>Welcome to KrishiMitra</h2>
        <div id="auth-message"></div>

        <div class="form-group">
            <label for="login-phone">Phone Number</label>
            <input type="tel" id="login-phone" placeholder="+91XXXXXXXXXX" required>
        </div>

        <div class="auth-buttons">
            <button type="button" class="btn btn-primary" onclick="sendOtp()">Send OTP</button>
        </div>

        <div class="auth-switch">
            Don't have an account? <a href="#" onclick="showSignupForm()">Sign Up</a>
        </div>
    </div>

    <!-- Signup Form -->
    <div id="signup-form" class="auth-form" style="display: none;">
        <h2>Join KrishiMitra</h2>
        <div id="signup-message"></div>

        <div class="form-group">
            <label for="signup-name">Full Name</label>
            <input type="text" id="signup-name" placeholder="Enter your full name" required>
        </div>

        <div class="form-group">
            <label for="signup-phone">Phone Number</label>
            <input type="tel" id="signup-phone" placeholder="+91XXXXXXXXXX" required>
        </div>

        <div class="form-group">
            <label for="signup-city">City</label>
            <input type="text" id="signup-city" placeholder="Enter your city" required>
        </div>

        <div class="form-group">
            <label for="signup-area">Area/Village</label>
            <input type="text" id="signup-area" placeholder="Enter your area">
        </div>

        <div class="form-group">
            <label for="signup-local">Local Address</label>
            <input type="text" id="signup-local" placeholder="Enter local address">
        </div>

        <div class="auth-buttons">
            <button type="button" class="btn btn-primary" onclick="signup()">Sign Up</button>
        </div>

        <div class="auth-switch">
            Already have an account? <a href="#" onclick="showLoginForm()">Login</a>
        </div>
    </div>

    <!-- OTP Verification Form -->
    <div id="otp-form" class="auth-form" style="display: none;">
        <h2>Verify OTP</h2>
        <div id="otp-message"></div>

        <p style="text-align: center; margin-bottom: 20px; color: #666;">
            We've sent a 6-digit code to <span id="otp-phone-display"></span>
        </p>

        <div class="form-group">
            <label for="otp-code">Enter OTP</label>
            <input type="text" id="otp-code" placeholder="Enter 6-digit code" maxlength="6" required>
        </div>

        <div class="auth-buttons">
            <button type="button" class="btn btn-primary" onclick="verifyOtp()">Verify OTP</button>
        </div>

        <div class="auth-switch">
            <a href="#" onclick="resendOtp()">Resend OTP</a> |
            <a href="#" onclick="showLoginForm()">Back to Login</a>
        </div>
    </div>
</div>

<!-- Header -->
<header>
    <div class="container">
        <div class="header-content">
            <div class="logo">
                <i class="fas fa-seedling"></i>
                <h1>DhartiMitra</h1>
            </div>
            <button class="mobile-menu-btn" onclick="toggleMobileMenu()">
               
            </button>
            <nav class="nav-menu">
                <ul>
                    <li><a href="#" class="nav-link" data-page="home">Home</a></li>
                    <li><a href="#" class="nav-link" data-page="advisory">Crop Advisory</a></li>
                    <li><a href="#" class="nav-link" data-page="farming-equipment">Farming Equipment</a></li>
                    <li><a href="#" class="nav-link" data-page="chatbot">AI Chatbot</a></li>
                    <li><a href="#" class="nav-link" data-page="market-tracking">Market Price Tracking</a></li>
                    <li><a href="#" class="nav-link" data-page="resources">Resources</a></li>
                    <li><a href="#" class="nav-link" data-page="weather">Weather</a></li>
                    <div class="user-info" id="user-info" style="display: none;">
                        <span id="user-name"></span>
                        <button class="logout-btn" onclick="logout()">Logout</button>
                    </div>
                </ul>
            </nav>
        </div>
    </div>
</header>

<!-- Home Page -->
<section id="home" class="page active">
    <!-- Hero Section -->
    <div class="hero">
        <div class="container">
            <div class="hero-content">
                <h2>Smart Crop Advisory for Small & Marginal Farmers</h2>
                <p>Get personalized, AI-powered advice for your crops. Increase yields, reduce costs, and farm smarter with our expert guidance.</p>
                <a href="#" class="btn nav-link" data-page="advisory">Get Free Advice</a>
            </div>
        </div>
    </div>

    <!-- Features Section -->
    <div class="features">
        <div class="container">
            <div class="section-title">
                <h2>How We Help Farmers</h2>
                <p>Our smart advisory system provides actionable insights tailored to your specific farming conditions</p>
            </div>
            <div class="features-grid">
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-cloud-sun"></i>
                    </div>
                    <h3>Weather Alerts</h3>
                    <p>Get precise weather forecasts and alerts for your specific location to protect your crops.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-bug"></i>
                    </div>
                    <h3>Pest Management</h3>
                    <p>Identify and manage pests and diseases with eco-friendly solutions.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-tint"></i>
                    </div>
                    <h3>Irrigation Advice</h3>
                    <p>Optimize water usage with smart irrigation recommendations.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <h3>Yield Prediction</h3>
                    <p>Accurate yield forecasts to help you plan harvest and sales.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- How It Works -->
    <div class="how-it-works">
        <div class="container">
            <div class="section-title">
                <h2>How It Works</h2>
                <p>Getting personalized crop advice is simple with our system</p>
            </div>
            <div class="steps">
                <div class="step">
                    <div class="step-number">1</div>
                    <h3>Share Your Details</h3>
                    <p>Tell us about your crops, location, and soil type</p>
                </div>
                <div class="step">
                    <div class="step-number">2</div>
                    <h3>We Analyze</h3>
                    <p>Our system processes your data with weather and market information</p>
                </div>
                <div class="step">
                    <div class="step-number">3</div>
                    <h3>Get Recommendations</h3>
                    <p>Receive actionable advice on your phone via SMS or app</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Testimonials -->
    <div class="testimonials">
        <div class="container">
            <div class="section-title">
                <h2>Success Stories</h2>
                <p>Hear from farmers who have benefited from our advisory system</p>
            </div>
            <div class="testimonial-grid">
                <div class="testimonial-card">
                    <div class="testimonial-text">
                        "The pest management advice saved my cotton crop from whitefly infestation. I was able to take action before it was too late."
                    </div>
                    <div class="testimonial-author">
                        <div class="author-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <div>
                            <h4>Rajesh Kumar</h4>
                            <p>Cotton Farmer, Maharashtra</p>
                        </div>
                    </div>
                </div>
                <div class="testimonial-card">
                    <div class="testimonial-text">
                        "The irrigation advice helped me reduce water usage by 30% while maintaining my yield. This saved me money and helped the environment."
                    </div>
                    <div class="testimonial-author">
                        <div class="author-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <div>
                            <h4>Priya Singh</h4>
                            <p>Rice Farmer, Punjab</p>
                        </div>
                    </div>
                </div>
                <div class="testimonial-card">
                    <div class="testimonial-text">
                        "The weather alerts warned me about unexpected rains, allowing me to harvest my wheat crop just in time. Saved me from major losses."
                    </div>
                    <div class="testimonial-author">
                        <div class="author-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <div>
                            <h4>Amir Khan</h4>
                            <p>Wheat Farmer, Uttar Pradesh</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Farming Equipment Page -->
<section id="farming-equipment" class="page">
    <div class="equipment-container">
        <div class="equipment-header">
            <h2>Farming Equipment Marketplace</h2>
            <p>Find the best agricultural equipment for your farming needs</p>
        </div>

        <div class="stats">
            <div class="stats-grid">
                <div class="stat-item">
                    <h3>12</h3>
                    <p>Equipment Categories</p>
                </div>
                <div class="stat-item">
                    <h3>150+</h3>
                    <p>Available Products</p>
                </div>
                <div class="stat-item">
                    <h3>24/7</h3>
                    <p>Customer Support</p>
                </div>
            </div>
        </div>

        <div class="search-filter">
            <input type="text" class="search-box" placeholder="Search equipment..." id="searchBox">
            <button class="filter-btn active" onclick="filterBy('all')">All</button>
            <button class="filter-btn" onclick="filterBy('tractor')">Tractors</button>
            <button class="filter-btn" onclick="filterBy('harvester')">Harvesters</button>
            <button class="filter-btn" onclick="filterBy('tools')">Tools</button>
        </div>

        <div class="equipment-grid" id="equipmentGrid">
            <!-- Equipment cards will be loaded here -->
        </div>
    </div>
</section>

<!-- Crop Advisory Page -->
<section id="advisory" class="page">
    <div class="container">
        <div class="section-title">
            <h2>AI Soil Analysis & Crop Advisory</h2>
            <p>Get AI-powered soil analysis and fertilizer recommendations for your crops</p>
        </div>

        <!-- Analysis Method Toggle -->
        <div class="method-toggle">
            <h4><i class="fas fa-microscope"></i> Choose Analysis Method</h4>
            <div class="toggle-buttons">
                <button type="button" class="btn-toggle active" id="manual-toggle" onclick="toggleAnalysisMethod('manual')">
                    <i class="fas fa-keyboard"></i> Manual Entry
                </button>
                <button type="button" class="btn-toggle" id="health-card-toggle" onclick="toggleAnalysisMethod('health-card')">
                    <i class="fas fa-id-card"></i> Soil Health Card
                </button>
            </div>
            <p style="margin-top: 10px; color: #666; font-size: 0.9rem;">
                Choose manual entry for custom analysis or upload your government-issued soil health card for instant analysis
            </p>
        </div>

        <div class="tool-container">
            <!-- Manual Analysis Form -->
            <form id="manual-form" enctype="multipart/form-data">
                <div class="form-group">
                    <label for="crop-type">Crop Type *</label>
                    <select id="crop-type" required>
                        <option value="">Select Crop</option>
                        <option value="wheat">Wheat</option>
                        <option value="rice">Rice</option>
                        <option value="corn">Corn</option>
                        <option value="sugarcane">Sugarcane</option>
                        <option value="cotton">Cotton</option>
                        <option value="potato">Potato</option>
                        <option value="tomato">Tomato</option>
                        <option value="onion">Onion</option>
                        <option value="soybean">Soybean</option>
                        <option value="groundnut">Groundnut</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="area-value">Farm Area *</label>
                    <input type="number" id="area-value" placeholder="Enter area value" step="0.1" min="0.1" required>
                </div>
                <div class="form-group">
                    <label for="area-unit">Area Unit *</label>
                    <select id="area-unit" required>
                        <option value="">Select Unit</option>
                        <option value="ACRE">Acre</option>
                        <option value="BIGHA">Bigha</option>
                        <option value="HECTARE">Hectare</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="season">Season *</label>
                    <select id="season" required>
                        <option value="">Select Season</option>
                        <option value="KHARIF">Kharif (Monsoon)</option>
                        <option value="RABI">Rabi (Winter)</option>
                        <option value="SUMMER">Summer</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="language">Language *</label>
                    <select id="language" required>
                        <option value="">Select Language</option>
                        <option value="en">English</option>
                        <option value="hi">Hindi</option>
                        <option value="bn">Bengali</option>
                        <option value="te">Telugu</option>
                        <option value="ta">Tamil</option>
                        <option value="gu">Gujarati</option>
                        <option value="mr">Marathi</option>
                        <option value="kn">Kannada</option>
                        <option value="ml">Malayalam</option>
                        <option value="pa">Punjabi</option>
                        <option value="or">Odia</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="location">Location (Optional)</label>
                    <input type="text" id="location" placeholder="Enter your location">
                </div>
                <div class="form-group">
                    <label for="soil-type-select">Soil Type (Optional)</label>
                    <select id="soil-type-select">
                        <option value="">Select Soil Type (or upload image)</option>
                        <option value="CLAY">Clay</option>
                        <option value="SANDY">Sandy</option>
                        <option value="LOAMY">Loamy</option>
                        <option value="SILT">Silt</option>
                        <option value="RED_SOIL">Red Soil</option>
                        <option value="BLACK_SOIL">Black Soil</option>
                        <option value="ALLUVIAL">Alluvial</option>
                        <option value="LATERITE">Laterite</option>
                        <option value="MOUNTAIN_SOIL">Mountain Soil</option>
                        <option value="DESERT_SOIL">Desert Soil</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="soil-image">Soil Image (Optional)</label>
                    <input type="file" id="soil-image" accept="image/jpeg,image/jpg,image/png,image/webp" onchange="previewImage(this, 'soil-preview')">
                    <small style="color: #666; display: block; margin-top: 5px;">
                        Upload a clear image of your soil for AI analysis (max 5MB)
                    </small>
                    <div id="soil-preview" class="image-preview" style="display: none;">
                        <img id="soil-preview-img" alt="Soil preview">
                        <button type="button" class="remove-image" onclick="removeImage('soil-image', 'soil-preview')">Remove Image</button>
                    </div>
                </div>
                <button type="submit" class="btn" id="manual-submit-btn">Get AI Soil Analysis</button>
            </form>

            <!-- Health Card Analysis Form -->
            <form id="health-card-form" style="display: none;" enctype="multipart/form-data">
                <div class="analysis-result" style="background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%); border-left: 4px solid #ff9800;">
                    <h4><i class="fas fa-id-card"></i> Soil Health Card Analysis</h4>
                    <p>Upload your government-issued soil health card for instant AI analysis. The system will extract all soil data automatically and provide personalized fertilizer recommendations.</p>

                    <div style="background: #e8f5e8; padding: 15px; border-radius: 8px; margin: 15px 0;">
                        <h5><i class="fas fa-lightbulb"></i> Health Card Benefits:</h5>
                        <ul style="margin: 10px 0; padding-left: 20px;">
                            <li>Automatic extraction of soil nutrients (NPK, pH, organic carbon)</li>
                            <li>Precise fertilizer recommendations based on official soil test data</li>
                            <li>Faster analysis with higher accuracy</li>
                            <li>No manual data entry required</li>
                        </ul>
                    </div>
                </div>

                <div class="form-group">
                    <label for="health-card-image">Soil Health Card Image *</label>
                    <input type="file" id="health-card-image" accept="image/jpeg,image/jpg,image/png,image/webp" onchange="previewImage(this, 'health-card-preview')" required>
                    <small style="color: #666; display: block; margin-top: 5px;">
                        Upload a clear, high-quality image of your soil health card (max 10MB)
                    </small>
                    <div id="health-card-preview" class="image-preview" style="display: none;">
                        <img id="health-card-preview-img" alt="Health card preview">
                        <button type="button" class="remove-image" onclick="removeImage('health-card-image', 'health-card-preview')">Remove Image</button>
                    </div>
                </div>

                <div class="form-group">
                    <label for="health-card-language">Language *</label>
                    <select id="health-card-language" required>
                        <option value="">Select Language</option>
                        <option value="en">English</option>
                        <option value="hi">Hindi</option>
                        <option value="bn">Bengali</option>
                        <option value="te">Telugu</option>
                        <option value="ta">Tamil</option>
                        <option value="gu">Gujarati</option>
                        <option value="mr">Marathi</option>
                        <option value="kn">Kannada</option>
                        <option value="ml">Malayalam</option>
                        <option value="pa">Punjabi</option>
                        <option value="or">Odia</option>
                    </select>
                </div>

                <!-- Override Options -->
                <div class="analysis-result" style="background: linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%); border-left: 4px solid #9c27b0;">
                    <h4><i class="fas fa-edit"></i> Override Options (Optional)</h4>
                    <p>You can override specific values if needed. Leave blank to use values from the health card.</p>

                    <div class="form-group">
                        <label for="override-crop-type">Override Crop Type</label>
                        <select id="override-crop-type">
                            <option value="">Use from health card</option>
                            <option value="wheat">Wheat</option>
                            <option value="rice">Rice</option>
                            <option value="corn">Corn</option>
                            <option value="sugarcane">Sugarcane</option>
                            <option value="cotton">Cotton</option>
                            <option value="potato">Potato</option>
                            <option value="tomato">Tomato</option>
                            <option value="onion">Onion</option>
                            <option value="soybean">Soybean</option>
                            <option value="groundnut">Groundnut</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="override-area-value">Override Area Value</label>
                        <input type="number" id="override-area-value" placeholder="Leave blank to use from card" step="0.1" min="0.1">
                    </div>

                    <div class="form-group">
                        <label for="override-area-unit">Override Area Unit</label>
                        <select id="override-area-unit">
                            <option value="">Use from health card</option>
                            <option value="ACRE">Acre</option>
                            <option value="BIGHA">Bigha</option>
                            <option value="HECTARE">Hectare</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="override-season">Override Season</label>
                        <select id="override-season">
                            <option value="">Use from health card</option>
                            <option value="KHARIF">Kharif (Monsoon)</option>
                            <option value="RABI">Rabi (Winter)</option>
                            <option value="SUMMER">Summer</option>
                        </select>
                    </div>
                </div>

                <button type="submit" class="btn" id="health-card-submit-btn">
                    <i class="fas fa-magic"></i> Analyze Health Card with AI
                </button>
            </form>

            <div class="result" id="result">
                <h3>AI Soil Analysis & Fertilizer Recommendations</h3>
                <div id="advice-content"></div>
            </div>
        </div>
    </div>
</section>

<!-- Chatbot Page -->
<section id="chatbot" class="page">
    <div class="container">
        <div class="section-title">
            <h2>AI Agriculture Assistant</h2>
            <p>Chat with our AI expert for instant farming advice and solutions</p>
        </div>
        <div class="tool-container" style="max-width: 900px;">
            <!-- Language Selector -->
            <div class="language-selector">
                <h4><i class="fas fa-globe"></i> Select Language / à¤­à¤¾à¤·à¤¾ à¤šà¥à¤¨à¥‡à¤‚</h4>
                <div class="form-group">
                    <select id="chat-language" onchange="updateWelcomeMessage()">
                        <option value="en" selected>English</option>
                        <option value="hi">à¤¹à¤¿à¤‚à¤¦à¥€ (Hindi)</option>
                        <option value="bn">à¦¬à¦¾à¦‚à¦²à¦¾ (Bengali)</option>
                        <option value="te">à°¤à±†à°²à±à°—à± (Telugu)</option>
                        <option value="ta">à®¤à®®à®¿à®´à¯ (Tamil)</option>
                        <option value="mr">à¤®à¤°à¤¾à¤ à¥€ (Marathi)</option>
                        <option value="gu">àª—à«àªœàª°àª¾àª¤à«€ (Gujarati)</option>
                        <option value="kn">à²•à²¨à³à²¨à²¡ (Kannada)</option>
                        <option value="ml">à´®à´²à´¯à´¾à´³à´‚ (Malayalam)</option>
                        <option value="pa">à¨ªà©°à¨œà¨¾à¨¬à©€ (Punjabi)</option>
                        <option value="or">à¬“à¬¡à¬¼à¬¿à¬† (Odia)</option>
                    </select>
                </div>
            </div>
            <div id="chat-container" style="background: white; border-radius: 10px; height: 500px; display: flex; flex-direction: column;">
                <!-- Chat Messages Area -->
                <div id="chat-messages" style="flex: 1; padding: 20px; overflow-y: auto; border-bottom: 2px solid #f0f7f0;">
                    <div class="chat-message bot-message" id="welcome-message">
                        <div class="message-content">
                            <i class="fas fa-robot" style="color: var(--primary); margin-right: 8px;"></i>
                            Hello! I'm your AI agriculture assistant. Ask me about crops, soil, fertilizers, pest control, or any farming-related questions. I can also analyze images of your plants or soil!
                        </div>
                    </div>
                </div>

                <!-- Chat Input Area -->
                <div style="padding: 20px;">
                    <form id="chat-form" style="display: flex; gap: 10px; align-items: end;">
                        <div style="flex: 1;">
                            <input type="text" id="chat-input" placeholder="Ask about farming, crops, soil, fertilizers..."
                                   style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem;">
                            <input type="file" id="chat-image" accept="image/jpeg,image/jpg,image/png,image/webp"
                                   style="margin-top: 5px; font-size: 0.9rem;">
                        </div>
                        <button type="submit" class="btn" style="margin: 0;">
                            <i class="fas fa-paper-plane"></i> Send
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Market Price Tracking Page (Integrated AGMARKNET) -->
<section id="market-tracking" class="page">
    <div class="container">
        <div class="section-title">
            <h2>Market Price Tracking</h2>
            <p>Track agricultural commodity prices and arrivals across India using AGMARKNET - Agricultural Marketing Division</p>
        </div>

        <!-- AGMARKNET Ticker -->
        <div style="background: #228B22; color: white; padding: 5px; overflow: hidden; margin-bottom: 20px; border-radius: 5px;">
            <!-- <div class="ticker-text">
                AGMARKNET â€¢ Price: â‚¹350 Max Price: 4000 â€¢ Green Gram (Moong)(Whole) - Green (Whole) Max Price: 12500 Max Price: 8750 â€¢ Green Gram (Moong)(Whole) - Green
            </div> -->
        </div>

        <!-- AGMARKNET Header Integration -->
        <div class="agmarknet-header">
            <div class="header-top">
                <div class="logo-section">
                    <div class="logo">GOI</div>
                    <div class="agmarknet-logo">AGMARKNET</div>
                </div>
                <div class="header-controls">
                    <select><option>English</option></select>
                    <span>Skip to Main Content</span>
                    <span>ðŸ” A A A+</span>
                </div>
            </div>
            
            <nav class="navigation">
                <ul class="nav-items">
                    <li><a href="#"><span class="nav-icon"></span> Home</a></li>
                    <li><a href="#"><span class="nav-icon"></span> Agmarknet Projects</a></li>
                    <li><a href="#"><span class="nav-icon"></span> Price & Arrivals</a></li>
                    <li><a href="#"><span class="nav-icon"></span> Price Trend</a></li>
                    <li><a href="#"><span class="nav-icon"></span> Mobile App</a></li>
                    <li><a href="#"><span class="nav-icon"></span> Reach Us</a></li>
                    <li><a href="#"><span class="nav-icon"></span> Tender</a></li>
                </ul>
            </nav>
            
            <div class="search-bar">
                <strong>Search</strong>
                <div class="search-controls">
                    <label>Price/Arrivals:</label>
                    <select id="priceArrivals">
                        <option value="">Select</option>
                        <option value="price">Price</option>
                        <option value="arrivals">Arrivals</option>
                        <option value="both">Price & Arrivals</option>
                    </select>
                    
                    <label>Commodity:</label>
                    <select id="commodity">
                        <option value="">Select</option>
                        <optgroup label="Cereals">
                            <option value="rice">Rice</option>
                            <option value="wheat">Wheat</option>
                            <option value="maize">Maize</option>
                            <option value="bajra">Bajra(Pearl Millet)</option>
                            <option value="jowar">Jowar(Sorghum)</option>
                            <option value="ragi">Ragi (Finger Millet)</option>
                            <option value="barley">Barley</option>
                        </optgroup>
                        <optgroup label="Pulses">
                            <option value="arhar">Arhar (Tur/Red Gram)</option>
                            <option value="moong">Moong(Green Gram)</option>
                            <option value="urad">Urad (Black Gram)</option>
                            <option value="masoor">Masoor (Lentil)</option>
                            <option value="gram">Gram(Chana)</option>
                            <option value="field_pea">Field Pea</option>
                            <option value="black_eye_pea">Black Eye Pea</option>
                        </optgroup>
                        <optgroup label="Oil Seeds">
                            <option value="groundnut">Groundnut</option>
                            <option value="mustard">Mustard</option>
                            <option value="sunflower">Sunflower</option>
                            <option value="soyabean">Soyabean</option>
                            <option value="sesamum">Sesamum</option>
                            <option value="niger_seed">Niger Seed</option>
                            <option value="castor_seed">Castor Seed</option>
                            <option value="linseed">Linseed</option>
                            <option value="safflower">Safflower</option>
                        </optgroup>
                        <optgroup label="Vegetables">
                            <option value="onion">Onion</option>
                            <option value="potato">Potato</option>
                            <option value="tomato">Tomato</option>
                            <option value="cabbage">Cabbage</option>
                            <option value="cauliflower">Cauliflower</option>
                            <option value="green_chilli">Green Chilli</option>
                            <option value="brinjal">Brinjal</option>
                            <option value="lady_finger">Lady Finger</option>
                            <option value="bitter_gourd">Bitter Gourd</option>
                            <option value="bottle_gourd">Bottle Gourd</option>
                            <option value="cucumber">Cucumber</option>
                            <option value="pumpkin">Pumpkin</option>
                            <option value="capsicum">Capsicum</option>
                            <option value="carrot">Carrot</option>
                            <option value="radish">Radish</option>
                        </optgroup>
                        <optgroup label="Fruits">
                            <option value="apple">Apple</option>
                            <option value="banana">Banana</option>
                            <option value="orange">Orange</option>
                            <option value="grapes">Grapes</option>
                            <option value="mango">Mango</option>
                            <option value="pomegranate">Pomegranate</option>
                            <option value="guava">Guava</option>
                            <option value="papaya">Papaya</option>
                            <option value="watermelon">Watermelon</option>
                            <option value="pineapple">Pineapple</option>
                            <option value="coconut">Coconut</option>
                            <option value="sweet_lime">Sweet Lime</option>
                        </optgroup>
                        <optgroup label="Spices">
                            <option value="turmeric">Turmeric</option>
                            <option value="coriander">Coriander</option>
                            <option value="cumin">Cumin</option>
                            <option value="fenugreek">Fenugreek</option>
                            <option value="red_chilli">Red Chilli</option>
                            <option value="black_pepper">Black Pepper</option>
                            <option value="cardamom">Cardamom</option>
                            <option value="clove">Clove</option>
                            <option value="ginger">Ginger</option>
                            <option value="garlic">Garlic</option>
                        </optgroup>
                        <optgroup label="Cash Crops">
                            <option value="cotton">Cotton</option>
                            <option value="sugarcane">Sugarcane</option>
                            <option value="jute">Jute</option>
                            <option value="tobacco">Tobacco</option>
                        </optgroup>
                    </select>
                    
                    <label>State:</label>
                    <select id="stateSelect">
                        <option value="">Select</option>
                        <option value="Andhra Pradesh">Andhra Pradesh</option>
                        <option value="Bihar">Bihar</option>
                        <option value="Gujarat">Gujarat</option>
                        <option value="Haryana">Haryana</option>
                        <option value="Karnataka">Karnataka</option>
                        <option value="Madhya Pradesh">Madhya Pradesh</option>
                        <option value="Maharashtra">Maharashtra</option>
                        <option value="Punjab">Punjab</option>
                        <option value="Rajasthan">Rajasthan</option>
                        <option value="Tamil Nadu">Tamil Nadu</option>
                        <option value="Uttar Pradesh">Uttar Pradesh</option>
                        <option value="West Bengal">West Bengal</option>
                    </select>
                    
                    <label>District:</label>
                    <select id="districtSelect">
                        <option value="">Select State First</option>
                    </select>
                    
                    <label>Market:</label>
                    <select id="marketSelect">
                        <option value="">Select District First</option>
                    </select>
                    
                    <label>Date From:</label>
                    <input type="date" id="dateFrom" value="2024-09-17">
                    
                    <label>Date To:</label>
                    <input type="date" id="dateTo" value="2024-09-17">
                    
                    <button class="search-btn" onclick="performSearch()">Go</button>
                </div>
            </div>
        </div>

        <!-- AGMARKNET Content Area -->
        <div class="content-area">
            <aside class="sidebar">
                <a href="#" class="sidebar-item"><span class="sidebar-icon"></span> Market Daily Data Entry</a>
                <a href="#" class="sidebar-item"><span class="sidebar-icon"></span> Market Profile Update</a>
                <a href="#" class="sidebar-item"><span class="sidebar-icon"></span> DMI Portal</a>
                <a href="#" class="sidebar-item"><span class="sidebar-icon"></span> Agmarknet Portal</a>
                <a href="#" class="sidebar-item"><span class="sidebar-icon"></span> Marketing Board</a>
                <a href="#" class="sidebar-item"><span class="sidebar-icon"></span> Research Studies</a>
                <a href="#" class="sidebar-item"><span class="sidebar-icon"></span> Community Profiles</a>
                <a href="#" class="sidebar-item"><span class="sidebar-icon"></span> Food Outlook</a>
                <a href="#" class="sidebar-item"><span class="sidebar-icon"></span> Related Links</a>
                <a href="#" class="sidebar-item"><span class="sidebar-icon"></span> Market Profile</a>
                <a href="#" class="sidebar-item"><span class="sidebar-icon"></span> SMS Registration</a>
                <a href="#" class="sidebar-item"><span class="sidebar-icon"></span> Performance Monitoring</a>
                <a href="#" class="sidebar-item"><span class="sidebar-icon"></span> FAQ</a>
                <a href="#" class="sidebar-item"><span class="sidebar-icon"></span> Feedback/Suggestions</a>
            </aside>

            <main class="main-content">
                <div class="dashboard-header">ðŸ“Š Dashboard</div>
                
                <div class="dashboard-content">
                    <div class="chart-container">
                        <div class="chart-header">Commodity-wise Graph</div>
                        <div class="chart-content">
                            <div class="bar-chart">
                                <div class="bar" style="height: 40%"></div>
                                <div class="bar" style="height: 60%"></div>
                                <div class="bar" style="height: 80%"></div>
                                <div class="bar" style="height: 45%"></div>
                                <div class="bar" style="height: 70%"></div>
                                <div class="bar" style="height: 55%"></div>
                                <div class="bar" style="height: 90%"></div>
                                <div class="bar" style="height: 35%"></div>
                                <div class="bar" style="height: 65%"></div>
                                <div class="bar" style="height: 75%"></div>
                            </div>
                        </div>
                    </div>

                    <div class="chart-container">
                        <div class="chart-header">Market-wise Graph</div>
                        <div class="chart-content">
                            <div class="bar-chart">
                                <div class="bar" style="height: 30%; background: linear-gradient(to top, #FF6B35, #FF8C42);"></div>
                                <div class="bar" style="height: 50%; background: linear-gradient(to top, #FF6B35, #FF8C42);"></div>
                                <div class="bar" style="height: 70%; background: linear-gradient(to top, #FF6B35, #FF8C42);"></div>
                                <div class="bar" style="height: 85%; background: linear-gradient(to top, #FF6B35, #FF8C42);"></div>
                                <div class="bar" style="height: 95%; background: linear-gradient(to top, #FF6B35, #FF8C42);"></div>
                                <div class="bar" style="height: 60%; background: linear-gradient(to top, #FF6B35, #FF8C42);"></div>
                            </div>
                        </div>
                    </div>

                    <div class="chart-container">
                        <div class="chart-header">Daily Market Report</div>
                        <div class="chart-content">
                            <div class="bar-chart">
                                <div class="bar" style="height: 85%; background: linear-gradient(to top, #2E8B57, #228B22);"></div>
                                <div class="bar" style="height: 65%; background: linear-gradient(to top, #2E8B57, #228B22);"></div>
                                <div class="bar" style="height: 45%; background: linear-gradient(to top, #2E8B57, #228B22);"></div>
                                <div class="bar" style="height: 25%; background: linear-gradient(to top, #2E8B57, #228B22);"></div>
                            </div>
                        </div>
                    </div>

                    <div class="chart-container">
                        <div class="chart-header">Price Trend</div>
                        <div class="chart-content">
                            <div class="line-chart">
                                <div class="trend-line"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="searchResults" class="search-results">
                    <div class="search-results-header">Search Results</div>
                    <div id="searchContent"></div>
                </div>
            </main>

            <aside class="right-sidebar">
                <div class="mandi-prices">
                    <div class="mandi-header">Today's Mandi Prices</div>
                    <div class="mandi-content">
                        <div style="font-size: 12px; margin-bottom: 10px;">
                            <strong>For more queries on Prices and Arrivals click here</strong>
                        </div>
                        <div class="stats-info">
                            <div><strong>All India Level Price Range (Rs./Quintal):</strong> 17-Sep-2024</div>
                            <div><strong>Markets Reported:</strong> 748</div>
                            <div><strong>Prices Reported</strong></div>
                        </div>
                    </div>
                </div>

                <div class="commodity-list">
                    <div class="commodity-header">Commodity</div>
                    <div class="commodity-item">
                        <span>Cereals</span>
                        <span class="plus-icon">+</span>
                    </div>
                    <div class="commodity-item">
                        <span>Pulses</span>
                        <span class="plus-icon">+</span>
                    </div>
                    <div class="commodity-item">
                        <span>Oil Seeds</span>
                        <span class="plus-icon">+</span>
                    </div>
                    <div class="commodity-item">
                        <span>Fiber Crops</span>
                        <span class="plus-icon">+</span>
                    </div>
                    <div class="commodity-item">
                        <span>Fruits</span>
                        <span class="plus-icon">+</span>
                    </div>
                    <div class="commodity-item">
                        <span>Vegetables</span>
                        <span class="plus-icon">+</span>
                    </div>
                    <div class="commodity-item">
                        <span>Spices</span>
                        <span class="plus-icon">+</span>
                    </div>
                    <div class="commodity-item">
                        <span>Beverages</span>
                        <span class="plus-icon">+</span>
                    </div>
                    <div class="commodity-item">
                        <span>Others</span>
                        <span class="plus-icon">+</span>
                    </div>
                    <div class="commodity-item">
                        <span>Drug and Narcotics</span>
                        <span class="plus-icon">+</span>
                    </div>
                    <div class="commodity-item">
                        <span>Forest Products</span>
                        <span class="plus-icon">+</span>
                    </div>
                    <div class="commodity-item">
                        <span>Livestock/Poultry/Fisheries</span>
                        <span class="plus-icon">+</span>
                    </div>
                    <div class="commodity-item">
                        <span>Flowers</span>
                        <span class="plus-icon">+</span>
                    </div>
                    <div class="commodity-item">
                        <span>Oils and Fats</span>
                        <span class="plus-icon">+</span>
                    </div>
                </div>
            </aside>
        </div>
    </div>
</section>

<!-- Weather Page -->
<section id="weather" class="page">
    <div class="container">
        <div class="section-title">
            <h2>Weather Information</h2>
            <p>Get accurate weather data for your location</p>
        </div>
        <div class="tool-container">
            <form id="weather-form">
                <div class="form-group">
                    <label for="city">City Name</label>
                    <input type="text" id="weather-city" placeholder="Enter city name" required>
                </div>
                <button type="submit" class="btn">Get Weather</button>
            </form>
            <div class="result" id="weather-result">
                <h3>Weather Information</h3>
                <div id="weather-data"></div>
            </div>
        </div>
    </div>
</section>

<!-- Resources Page -->
<section id="resources" class="page">
    <div class="container">
        <div class="section-title">
            <h2>Farming Resources</h2>
            <p>Educational materials and guides for better farming practices</p>
        </div>
        <div class="features-grid">
            <div class="feature-card">
                <div class="feature-icon">
                    <i class="fas fa-book"></i>
                </div>
                <h3>Crop Guides</h3>
                <p>Detailed guides for growing various crops in different conditions</p>
                <a href="#" class="btn" style="margin-top: 15px;">Download</a>
            </div>
            <div class="feature-card">
                <div class="feature-icon">
                    <i class="fas fa-video"></i>
                </div>
                <h3>Video Tutorials</h3>
                <p>Step-by-step videos on modern farming techniques</p>
                <a href="#" class="btn" style="margin-top: 15px;">Watch</a>
            </div>
            <div class="feature-card">
                <div class="feature-icon">
                    <i class="fas fa-calendar-alt"></i>
                </div>
                <h3>Farming Calendar</h3>
                <p>Optimal timing for planting and harvesting different crops</p>
                <a href="#" class="btn" style="margin-top: 15px;">View</a>
            </div>
            <div class="feature-card">
                <div class="feature-icon">
                    <i class="fas fa-phone-alt"></i>
                </div>
                <h3>Expert Help</h3>
                <p>Connect with agricultural experts for personalized guidance</p>
                <a href="#" class="btn" style="margin-top: 15px;">Contact</a>
            </div>
        </div>
    </div>
</section>

<!-- Footer -->
<footer>
    <div class="container">
        <div class="footer-content">
            <div class="footer-column">
                <h3>KrishiMitra</h3>
                <p>Empowering small and marginal farmers with smart crop advisory services for sustainable agriculture.</p>
                <div class="social-links">
                    <a href="#"><i class="fab fa-facebook-f"></i></a>
                    <a href="#"><i class="fab fa-twitter"></i></a>
                    <a href="#"><i class="fab fa-instagram"></i></a>
                    <a href="#"><i class="fab fa-youtube"></i></a>
                </div>
            </div>
            <div class="footer-column">
                <h3>Quick Links</h3>
                <ul>
                    <li><a href="#" class="nav-link" data-page="home">Home</a></li>
                    <li><a href="#" class="nav-link" data-page="advisory">Crop Advisory</a></li>
                    <li><a href="#" class="nav-link" data-page="farming-equipment">Farming Equipment</a></li>
                    <li><a href="#" class="nav-link" data-page="chatbot">AI Chatbot</a></li>
                    <li><a href="#" class="nav-link" data-page="market-tracking">Market Price Tracking</a></li>
                    <li><a href="#" class="nav-link" data-page="weather">Weather</a></li>
                </ul>
            </div>
            <div class="footer-column">
                <h3>Contact Us</h3>
                <ul>
                    <li><i class="fas fa-phone"></i> +91 9876543210</li>
                    <li><i class="fas fa-envelope"></i> info@krishimitra.com</li>
                    <li><i class="fas fa-map-marker-alt"></i> Agriculture Center, New Delhi</li>
                </ul>
            </div>
        </div>
        <div class="copyright">
            <p>&copy; 2023 KrishiMitra. All rights reserved.</p>
        </div>
    </div>
</footer>

<!-- Enhanced Weather Widget -->
<div id="floating-weather" aria-label="Weather Information" role="region" tabindex="0">
    <h4><i class="fas fa-cloud-sun"></i> Current Weather</h4>
    <div class="weather-city" id="weather-city-name">Select City</div>
    <div id="floating-weather-content">
        <div class="weather-loading">
            <i class="fas fa-spinner fa-spin"></i> Loading weather data...
        </div>
    </div>
</div>

<script>
    // Configuration - Updated with your backend URLs
    const API_BASE_URL = 'http://localhost:8080/api/v1';
    const SOIL_ANALYSIS_URL = 'http://localhost:8081/api/producer/soil-analysis-form';
    const FERTILIZER_ANALYSIS_URL = 'http://localhost:8082/api/fertilizer/analyze';
    const HEALTH_CARD_ANALYSIS_URL = 'http://localhost:8082/api/fertilizer/analyze-health-card';
    const CHATBOT_URL = 'http://localhost:8082/api/agriculture/chat';

    // State management
    let currentUser = null;
    let accessToken = null;
    let refreshToken = null;
    let currentPhone = null;
    let chatSessionId = null;
    let userCity = null;
    let currentAnalysisMethod = 'manual';

    // DOM elements
    const authOverlay = document.getElementById('auth-overlay');
    const loginForm = document.getElementById('login-form');
    const signupForm = document.getElementById('signup-form');
    const otpForm = document.getElementById('otp-form');
    const userInfo = document.getElementById('user-info');
    const floatingWeather = document.getElementById('floating-weather');

    // Initialize app
    document.addEventListener('DOMContentLoaded', function() {
        checkExistingAuth();
        initializeNavigation();
        initializeForms();
        initializeWeatherWidget();
        initializeAgmarknet();  // Initialize AGMARKNET functionality

        // Add click handler for weather widget
        floatingWeather.addEventListener('click', function() {
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.getElementById('weather').classList.add('active');
            window.scrollTo(0, 0);
        });
    });

    // AGMARKNET Initialization
    function initializeAgmarknet() {
        // Comprehensive state-wise district and market data for all Indian states
        const stateData = {
            "Andhra Pradesh": {
                districts: ["Visakhapatnam", "Vijayawada", "Guntur", "Nellore", "Kurnool", "Kadapa", "Tirupati", "Anantapur", "Kakinada", "Rajahmundry", "Eluru", "Ongole", "Vizianagaram", "Srikakulam"],
                markets: {
                    "Visakhapatnam": ["Visakhapatnam APMC", "Anakapalli Market", "Narsipatnam APMC", "Paderu Market"],
                    "Vijayawada": ["Vijayawada APMC", "Gannavaram Market", "Jaggayyapeta APMC", "Mylavaram Market"],
                    "Guntur": ["Guntur APMC", "Tenali Market", "Bapatla APMC", "Narasaraopet Market", "Vinukonda APMC"],
                    "Nellore": ["Nellore APMC", "Kavali Market", "Gudur APMC", "Atmakur Market"],
                    "Kurnool": ["Kurnool APMC", "Nandyal Market", "Adoni APMC", "Allagadda Market"],
                    "Kadapa": ["Kadapa APMC", "Proddatur Market", "Jammalamadugu APMC", "Rajampet Market"],
                    "Tirupati": ["Tirupati APMC", "Chittoor Market", "Madanapalle APMC", "Srikalahasti Market"],
                    "Anantapur": ["Anantapur APMC", "Hindupur Market", "Guntakal APMC", "Dharmavaram Market"],
                    "Kakinada": ["Kakinada APMC", "Amalapuram Market", "Pithapuram APMC", "Tuni Market"],
                    "Rajahmundry": ["Rajahmundry APMC", "Kovvur Market", "Tanuku APMC", "Nidadavole Market"],
                    "Eluru": ["Eluru APMC", "Bhimavaram Market", "Tadepalligudem APMC", "Narasapuram Market"],
                    "Ongole": ["Ongole APMC", "Chirala Market", "Kandukur APMC", "Markapur Market"],
                    "Vizianagaram": ["Vizianagaram APMC", "Bobbili Market", "Parvathipuram APMC", "Salur Market"],
                    "Srikakulam": ["Srikakulam APMC", "Palakonda Market", "Narasannapeta APMC", "Amadalavalasa Market"]
                }
            },
            "Bihar": {
                districts: ["Patna", "Gaya", "Bhagalpur", "Muzaffarpur", "Darbhanga", "Bihar Sharif", "Arrah", "Begusarai", "Katihar", "Munger", "Chhapra", "Samastipur", "Sasaram", "Hajipur", "Dehri", "Siwan", "Motihari", "Nawada", "Bagaha"],
                markets: {
                    "Patna": ["Patna APMC", "Danapur Market", "Fatuha APMC", "Khagaul Market"],
                    "Gaya": ["Gaya APMC", "Bodh Gaya Market", "Tekari APMC", "Sherghati Market"],
                    "Bhagalpur": ["Bhagalpur APMC", "Sultanganj Market", "Kahalgaon APMC", "Naugachia Market"],
                    "Muzaffarpur": ["Muzaffarpur APMC", "Sitamarhi Market", "Sheohar APMC", "Vaishali Market"],
                    "Darbhanga": ["Darbhanga APMC", "Madhubani Market", "Samastipur APMC", "Begusarai Market"],
                    "Bihar Sharif": ["Bihar Sharif APMC", "Rajgir Market", "Hilsa APMC", "Ekangarsarai Market"],
                    "Arrah": ["Arrah APMC", "Jagdishpur Market", "Piro APMC", "Tarari Market"],
                    "Begusarai": ["Begusarai APMC", "Barauni Market", "Sahebganj APMC", "Teghra Market"],
                    "Katihar": ["Katihar APMC", "Purnia Market", "Kishanganj APMC", "Araria Market"],
                    "Munger": ["Munger APMC", "Jamalpur Market", "Lakhisarai APMC", "Kharagpur Market"],
                    "Chhapra": ["Chhapra APMC", "Revelganj Market", "Marhaura APMC", "Amnour Market"],
                    "Samastipur": ["Samastipur APMC", "Dalsinghsarai Market", "Rosera APMC", "Pusa Market"],
                    "Sasaram": ["Sasaram APMC", "Nokha Market", "Kochas APMC", "Dehri Market"],
                    "Hajipur": ["Hajipur APMC", "Lalganj Market", "Mahua APMC", "Bidupur Market"],
                    "Dehri": ["Dehri APMC", "Dalmianagar Market", "Rohtas APMC"],
                    "Siwan": ["Siwan APMC", "Maharajganj Market", "Lakhi Sarai APMC"],
                    "Motihari": ["Motihari APMC", "Bettiah Market", "Bagaha APMC", "Raxaul Market"],
                    "Nawada": ["Nawada APMC", "Hisua Market", "Rajauli APMC"],
                    "Bagaha": ["Bagaha APMC", "Lauriya Market", "Narkatiaganj APMC"]
                }
            },
            "Gujarat": {
                districts: ["Ahmedabad", "Surat", "Vadodara", "Rajkot", "Bhavnagar", "Jamnagar", "Gandhinagar", "Anand", "Mehsana", "Banaskantha", "Sabarkantha", "Kheda", "Panchmahal", "Dahod", "Valsad", "Navsari", "Bharuch"],
                markets: {
                    "Ahmedabad": ["Ahmedabad APMC", "Naroda APMC", "Bavla Market", "Daskroi APMC", "Sanand Market"],
                    "Surat": ["Surat APMC", "Kamrej Market", "Bardoli APMC", "Navsari Market", "Vyara APMC"],
                    "Vadodara": ["Vadodara APMC", "Ankleshwar Market", "Karjan APMC", "Padra Market", "Dabhoi APMC"],
                    "Rajkot": ["Rajkot APMC", "Gondal Market", "Jetpur APMC", "Morbi Market", "Wankaner APMC"],
                    "Bhavnagar": ["Bhavnagar APMC", "Mahuva Market", "Palitana APMC", "Sihor Market", "Talaja APMC"],
                    "Jamnagar": ["Jamnagar APMC", "Dwarka Market", "Khambhalia APMC", "Lalpur Market", "Kalavad APMC"],
                    "Gandhinagar": ["Gandhinagar APMC", "Kalol Market", "Mansa APMC", "Dehgam Market"],
                    "Anand": ["Anand APMC", "Kheda Market", "Nadiad APMC", "Borsad Market", "Petlad APMC"],
                    "Mehsana": ["Mehsana APMC", "Unjha Market", "Visnagar APMC", "Kheralu Market", "Patan APMC"],
                    "Banaskantha": ["Palanpur APMC", "Deesa Market", "Tharad APMC", "Dhanera Market", "Abu Road APMC"],
                    "Sabarkantha": ["Himmatnagar APMC", "Idar Market", "Khedbrahma APMC", "Modasa Market", "Talod APMC"],
                    "Kheda": ["Nadiad APMC", "Anand Market", "Kheda APMC", "Kapadvanj Market", "Mahudha APMC"],
                    "Panchmahal": ["Godhra APMC", "Halol Market", "Kalol APMC", "Lunawada Market", "Morwa APMC"],
                    "Dahod": ["Dahod APMC", "Jhalod Market", "Limkheda APMC", "Devgadh Baria Market"],
                    "Valsad": ["Valsad APMC", "Vapi Market", "Pardi APMC", "Dharampur Market", "Kaprada APMC"],
                    "Navsari": ["Navsari APMC", "Jalalpore Market", "Gandevi APMC", "Chikhli Market", "Vansda APMC"],
                    "Bharuch": ["Bharuch APMC", "Ankleshwar Market", "Jambusar APMC", "Amod Market", "Hansot APMC"]
                }
            },
            "Haryana": {
                districts: ["Faridabad", "Gurgaon", "Hisar", "Rohtak", "Panipat", "Karnal", "Sonipat", "Yamunanagar", "Ambala", "Kurukshetra", "Sirsa", "Fatehabad", "Jind", "Kaithal", "Bhiwani", "Mahendragarh", "Rewari", "Jhajjar"],
                markets: {
                    "Faridabad": ["Faridabad APMC", "Ballabhgarh Market", "Palwal APMC", "Hodal Market"],
                    "Gurgaon": ["Gurgaon APMC", "Sohna Market", "Nuh APMC", "Tauru Market", "Pataudi APMC"],
                    "Hisar": ["Hisar APMC", "Hansi Market", "Fatehabad APMC", "Ratia Market", "Adampur APMC"],
                    "Rohtak": ["Rohtak APMC", "Jhajjar Market", "Meham APMC", "Kalanaur Market", "Sampla APMC"],
                    "Panipat": ["Panipat APMC", "Samalkha Market", "Israna APMC", "Bapoli Market"],
                    "Karnal": ["Karnal APMC", "Gharaunda Market", "Assandh APMC", "Nilokheri Market", "Indri APMC"],
                    "Sonipat": ["Sonipat APMC", "Gohana Market", "Kharkhoda APMC", "Mundlana Market"],
                    "Yamunanagar": ["Yamunanagar APMC", "Jagadhri Market", "Bilaspur APMC", "Chhachhrauli Market"],
                    "Ambala": ["Ambala APMC", "Naraingarh Market", "Barara APMC", "Shahzadpur Market"],
                    "Kurukshetra": ["Kurukshetra APMC", "Thanesar Market", "Pehowa APMC", "Ladwa Market"],
                    "Sirsa": ["Sirsa APMC", "Dabwali Market", "Ellenabad APMC", "Kalanwali Market"],
                    "Fatehabad": ["Fatehabad APMC", "Tohana Market", "Ratia APMC", "Bhuna Market"],
                    "Jind": ["Jind APMC", "Safidon Market", "Julana APMC", "Narwana Market"],
                    "Kaithal": ["Kaithal APMC", "Cheeka Market", "Guhla APMC", "Rajaund Market"],
                    "Bhiwani": ["Bhiwani APMC", "Charkhi Dadri Market", "Loharu APMC", "Tosham Market"],
                    "Mahendragarh": ["Narnaul APMC", "Mahendragarh Market", "Kanina APMC", "Ateli Market"],
                    "Rewari": ["Rewari APMC", "Bawal Market", "Kosli APMC", "Jatusana Market"],
                    "Jhajjar": ["Jhajjar APMC", "Beri Market", "Matanhail APMC", "Badli Market"]
                }
            },
            "Karnataka": {
                districts: ["Bangalore", "Mysore", "Hubli", "Mangalore", "Belgaum", "Davangere", "Bellary", "Bijapur", "Shimoga", "Tumkur", "Hassan", "Udupi", "Chitradurga", "Kolar", "Mandya"],
                markets: {
                    "Bangalore": ["Bangalore APMC", "Yeshwantpur Market", "KR Market", "Madiwala Market"],
                    "Mysore": ["Mysore APMC", "Bandipur Market", "Nanjangud APMC", "T Narasipura Market"],
                    "Hubli": ["Hubli APMC", "Dharwad Market", "Gadag APMC", "Navalgund Market"],
                    "Mangalore": ["Mangalore APMC", "Udupi Market", "Puttur APMC", "Sullia Market"],
                    "Belgaum": ["Belgaum APMC", "Gokak Market", "Chikodi APMC", "Bailhongal Market"],
                    "Davangere": ["Davangere APMC", "Harihar Market", "Channagiri APMC", "Jagalur Market"],
                    "Bellary": ["Bellary APMC", "Hospet Market", "Siruguppa APMC", "Kudligi Market"],
                    "Bijapur": ["Bijapur APMC", "Bagalkot Market", "Jamkhandi APMC", "Indi Market"],
                    "Shimoga": ["Shimoga APMC", "Bhadravathi Market", "Sagar APMC", "Hosanagar Market"],
                    "Tumkur": ["Tumkur APMC", "Tiptur Market", "Madhugiri APMC", "Sira Market"],
                    "Hassan": ["Hassan APMC", "Arsikere Market", "Channarayapatna APMC", "Belur Market"],
                    "Udupi": ["Udupi APMC", "Kundapura Market", "Karkala APMC"],
                    "Chitradurga": ["Chitradurga APMC", "Hiriyur Market", "Challakere APMC"],
                    "Kolar": ["Kolar APMC", "Bangarapet Market", "Mulbagal APMC"],
                    "Mandya": ["Mandya APMC", "Maddur Market", "Malavalli APMC"]
                }
            },
            "Madhya Pradesh": {
                districts: ["Bhopal", "Indore", "Gwalior", "Jabalpur", "Ujjain", "Sagar", "Ratlam", "Satna", "Dewas", "Murwara", "Burhanpur", "Khandwa", "Bhind", "Morena", "Shivpuri"],
                markets: {
                    "Bhopal": ["Bhopal APMC", "Berasia Market", "Huzur APMC", "Raisen Market"],
                    "Indore": ["Indore APMC", "Sanver Market", "Depalpur APMC", "Mhow Market"],
                    "Gwalior": ["Gwalior APMC", "Dabra Market", "Bhitarwar APMC", "Morar Market"],
                    "Jabalpur": ["Jabalpur APMC", "Sihora Market", "Katni APMC", "Patan Market"],
                    "Ujjain": ["Ujjain APMC", "Nagda Market", "Tarana APMC", "Mahidpur Market"],
                    "Sagar": ["Sagar APMC", "Khurai Market", "Rehli APMC", "Banda Market"],
                    "Ratlam": ["Ratlam APMC", "Mandsaur Market", "Neemuch APMC", "Jaora Market"],
                    "Satna": ["Satna APMC", "Rewa Market", "Maihar APMC", "Nagod Market"],
                    "Dewas": ["Dewas APMC", "Bagli Market", "Tonk Khurd APMC", "Khategaon Market"],
                    "Murwara": ["Murwara APMC", "Panna Market", "Pawai APMC"],
                    "Burhanpur": ["Burhanpur APMC", "Nepanagar Market", "Shahpur APMC"],
                    "Khandwa": ["Khandwa APMC", "Omkareshwar Market", "Punasa APMC"],
                    "Bhind": ["Bhind APMC", "Lahar Market", "Mihona APMC"],
                    "Morena": ["Morena APMC", "Ambah Market", "Porsa APMC"],
                    "Shivpuri": ["Shivpuri APMC", "Kolaras Market", "Narwar APMC"]
                }
            },
            "Maharashtra": {
                districts: ["Mumbai", "Pune", "Nagpur", "Nashik", "Aurangabad", "Solapur", "Amravati", "Kolhapur", "Akola", "Latur", "Dhule", "Ahmednagar", "Chandrapur", "Parbhani", "Jalgaon"],
                markets: {
                    "Mumbai": ["Mumbai APMC", "Vashi Market", "Turbhe APMC", "Kalamboli Market"],
                    "Pune": ["Pune APMC", "Hadapsar Market", "Khed APMC", "Baramati Market"],
                    "Nagpur": ["Nagpur APMC", "Katol Market", "Hingna APMC", "Kamptee Market"],
                    "Nashik": ["Nashik APMC", "Malegaon Market", "Sinnar APMC", "Igatpuri Market"],
                    "Aurangabad": ["Aurangabad APMC", "Paithan Market", "Sillod APMC", "Kannad Market"],
                    "Solapur": ["Solapur APMC", "Pandharpur Market", "Barshi APMC", "Akkalkot Market"],
                    "Amravati": ["Amravati APMC", "Badnera Market", "Morshi APMC", "Chandur Railway Market"],
                    "Kolhapur": ["Kolhapur APMC", "Ichalkaranji Market", "Shirol APMC", "Kagal Market"],
                    "Akola": ["Akola APMC", "Telhara Market", "Barshitakli APMC", "Murtizapur Market"],
                    "Latur": ["Latur APMC", "Nilanga Market", "Ausa APMC", "Udgir Market"],
                    "Dhule": ["Dhule APMC", "Shirpur Market", "Sindkhede APMC", "Sakri Market"],
                    "Ahmednagar": ["Ahmednagar APMC", "Shrirampur Market", "Sangamner APMC", "Kopargaon Market"],
                    "Chandrapur": ["Chandrapur APMC", "Warora Market", "Ballarpur APMC", "Gadchiroli Market"],
                    "Parbhani": ["Parbhani APMC", "Jintur Market", "Pathri APMC", "Purna Market"],
                    "Jalgaon": ["Jalgaon APMC", "Bhusawal Market", "Amalner APMC", "Chopda Market"]
                }
            },
            "Punjab": {
                districts: ["Ludhiana", "Amritsar", "Jalandhar", "Patiala", "Bathinda", "Mohali", "Gurdaspur", "Hoshiarpur", "Kapurthala", "Sangrur", "Firozpur", "Faridkot", "Muktsar", "Moga"],
                markets: {
                    "Ludhiana": ["Ludhiana Grain Market", "Khanna APMC", "Samrala Market", "Payal APMC"],
                    "Amritsar": ["Amritsar APMC", "Tarn Taran Market", "Rayya APMC", "Jandiala Market"],
                    "Jalandhar": ["Jalandhar APMC", "Phillaur Market", "Nakodar APMC", "Shahkot Market"],
                    "Patiala": ["Patiala APMC", "Rajpura Market", "Nabha APMC", "Samana Market"],
                    "Bathinda": ["Bathinda APMC", "Maur Market", "Rampura APMC", "Talwandi Sabo Market"],
                    "Mohali": ["Mohali APMC", "Kharar Market", "Banur APMC", "Dera Bassi Market"],
                    "Gurdaspur": ["Gurdaspur APMC", "Pathankot Market", "Batala APMC", "Dera Baba Nanak Market"],
                    "Hoshiarpur": ["Hoshiarpur APMC", "Dasuya Market", "Mukerian APMC", "Garhshankar Market"],
                    "Kapurthala": ["Kapurthala APMC", "Phagwara Market", "Sultanpur APMC", "Dhilwan Market"],
                    "Sangrur": ["Sangrur APMC", "Malerkotla Market", "Sunam APMC", "Dhuri Market"],
                    "Firozpur": ["Firozpur APMC", "Zira Market", "Guru Har Sahai APMC", "Fazilka Market"],
                    "Faridkot": ["Faridkot APMC", "Jaitu Market", "Kotkapura APMC"],
                    "Muktsar": ["Muktsar APMC", "Giddarbaha Market", "Malout APMC"],
                    "Moga": ["Moga APMC", "Baghapurana Market", "Nihal Singh Wala APMC"]
                }
            },
            "Rajasthan": {
                districts: ["Jaipur", "Jodhpur", "Kota", "Bikaner", "Ajmer", "Udaipur", "Bhilwara", "Alwar", "Bharatpur", "Pali", "Tonk", "Kishangarh", "Beawar", "Hanumangarh", "Ganganagar"],
                markets: {
                    "Jaipur": ["Jaipur APMC", "Sanganer Market", "Chomu APMC", "Amber Market"],
                    "Jodhpur": ["Jodhpur APMC", "Phalodi Market", "Bilara APMC", "Osian Market"],
                    "Kota": ["Kota APMC", "Baran Market", "Jhalawar APMC", "Ramganj Market"],
                    "Bikaner": ["Bikaner APMC", "Nokha Market", "Lunkaransar APMC", "Kolayat Market"],
                    "Ajmer": ["Ajmer APMC", "Beawar Market", "Kishangarh APMC", "Kekri Market"],
                    "Udaipur": ["Udaipur APMC", "Chittorgarh Market", "Dungarpur APMC", "Banswara Market"],
                    "Bhilwara": ["Bhilwara APMC", "Shahpura Market", "Mandal APMC", "Hurda Market"],
                    "Alwar": ["Alwar APMC", "Tijara Market", "Behror APMC", "Kishangarh Bas Market"],
                    "Bharatpur": ["Bharatpur APMC", "Deeg Market", "Weir APMC", "Kumher Market"],
                    "Pali": ["Pali APMC", "Falna Market", "Sumerpur APMC", "Jaitaran Market"],
                    "Tonk": ["Tonk APMC", "Newai Market", "Deoli APMC"],
                    "Kishangarh": ["Kishangarh APMC", "Roopangarh Market", "Sarwar APMC"],
                    "Beawar": ["Beawar APMC", "Masuda Market", "Pisangan APMC"],
                    "Hanumangarh": ["Hanumangarh APMC", "Rawatsar Market", "Nohar APMC"],
                    "Ganganagar": ["Ganganagar APMC", "Suratgarh Market", "Anupgarh APMC"]
                }
            },
            "Tamil Nadu": {
                districts: ["Chennai", "Coimbatore", "Madurai", "Tiruchirappalli", "Salem", "Tirunelveli", "Erode", "Vellore", "Thoothukudi", "Dindigul", "Thanjavur", "Tiruppur", "Cuddalore", "Kanchipuram", "Villupuram"],
                markets: {
                    "Chennai": ["Koyambedu Market", "Chennai APMC", "Madhavaram Market", "Perambur Market"],
                    "Coimbatore": ["Coimbatore APMC", "Mettupalayam Market", "Pollachi APMC", "Udumalaipettai Market"],
                    "Madurai": ["Madurai APMC", "Usilampatti Market", "Melur APMC", "Thirumangalam Market"],
                    "Tiruchirappalli": ["Trichy APMC", "Lalgudi Market", "Musiri APMC", "Srirangam Market"],
                    "Salem": ["Salem APMC", "Mettur Market", "Attur APMC", "Sankagiri Market"],
                    "Tirunelveli": ["Tirunelveli APMC", "Palayamkottai Market", "Nanguneri APMC", "Ambasamudram Market"],
                    "Erode": ["Erode APMC", "Gobichettipalayam Market", "Bhavani APMC", "Sathyamangalam Market"],
                    "Vellore": ["Vellore APMC", "Arakkonam Market", "Ambur APMC", "Vaniyambadi Market"],
                    "Thoothukudi": ["Thoothukudi APMC", "Kovilpatti Market", "Tiruchendur APMC", "Srivaikuntam Market"],
                    "Dindigul": ["Dindigul APMC", "Palani Market", "Oddanchatram APMC", "Kodaikanal Market"],
                    "Thanjavur": ["Thanjavur APMC", "Kumbakonam Market", "Pattukkottai APMC", "Orathanadu Market"],
                    "Tiruppur": ["Tiruppur APMC", "Dharapuram Market", "Avinashi APMC", "Kangeyam Market"],
                    "Cuddalore": ["Cuddalore APMC", "Chidambaram Market", "Virudhachalam APMC", "Panruti Market"],
                    "Kanchipuram": ["Kanchipuram APMC", "Tambaram Market", "Chengalpattu APMC", "Maduranthakam Market"],
                    "Villupuram": ["Villupuram APMC", "Tindivanam Market", "Kallakurichi APMC", "Ulundurpet Market"]
                }
            }
        };

        // Populate districts based on selected state
        document.getElementById('stateSelect').addEventListener('change', function() {
            const state = this.value;
            const districtSelect = document.getElementById('districtSelect');
            const marketSelect = document.getElementById('marketSelect');
            
            // Reset district and market dropdowns
            districtSelect.innerHTML = '<option value="">Select District</option>';
            marketSelect.innerHTML = '<option value="">Select Market</option>';
            
            if (state && stateData[state]) {
                stateData[state].districts.forEach(district => {
                    const option = document.createElement('option');
                    option.value = district;
                    option.textContent = district;
                    districtSelect.appendChild(option);
                });
            } else {
                districtSelect.innerHTML = '<option value="">Select State First</option>';
            }
        });

        // Populate markets based on selected district
        document.getElementById('districtSelect').addEventListener('change', function() {
            const state = document.getElementById('stateSelect').value;
            const district = this.value;
            const marketSelect = document.getElementById('marketSelect');
            
            // Reset market dropdown
            marketSelect.innerHTML = '<option value="">Select Market</option>';
            
            if (state && district && stateData[state] && stateData[state].markets[district]) {
                stateData[state].markets[district].forEach(market => {
                    const option = document.createElement('option');
                    option.value = market;
                    option.textContent = market;
                    marketSelect.appendChild(option);
                });
            } else {
                marketSelect.innerHTML = '<option value="">Select District First</option>';
            }
        });

        // Toggle plus/minus icon for commodity items
        document.querySelectorAll('.commodity-item').forEach(item => {
            item.addEventListener('click', function() {
                const plusIcon = this.querySelector('.plus-icon');
                plusIcon.classList.toggle('expanded');
                // Optionally, add logic to show/hide sub-items here
            });
        });

        // Search functionality
        window.performSearch = function() {
            const priceArrivals = document.getElementById('priceArrivals').value;
            const commodity = document.getElementById('commodity').value;
            const state = document.getElementById('stateSelect').value;
            const district = document.getElementById('districtSelect').value;
            const market = document.getElementById('marketSelect').value;
            const dateFrom = document.getElementById('dateFrom').value;
            const dateTo = document.getElementById('dateTo').value;
            const searchResults = document.getElementById('searchResults');
            const searchContent = document.getElementById('searchContent');

            // Validate inputs
            if (!priceArrivals || !commodity || !state || !district || !market || !dateFrom || !dateTo) {
                searchContent.innerHTML = '<div class="error-message">Please fill all fields to perform the search.</div>';
                searchResults.classList.add('show');
                return;
            }

            // Simulated search results (empty to trigger "No Data Found")
            const mockData = [];

            // Generate results table
            let tableHTML = `
                <table class="results-table">
                    <thead>
                        <tr>
                            <th>Market</th>
                            <th>Commodity</th>
                            <th>${priceArrivals === 'both' ? 'Price / Arrivals' : priceArrivals === 'price' ? 'Price' : 'Arrivals'}</th>
                            <th>Date</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            if (mockData.length > 0) {
                mockData.forEach(row => {
                    tableHTML += `
                        <tr>
                            <td>${row.market}</td>
                            <td>${row.commodity}</td>
                            <td>${priceArrivals === 'both' ? `${row.price} / ${row.arrivals}` : priceArrivals === 'price' ? row.price : row.arrivals}</td>
                            <td>${row.date}</td>
                        </tr>
                    `;
                });
            } else {
                searchContent.innerHTML = '<div class="error-message">No Data Found</div>';
                searchResults.classList.add('show');
                return;
            }

            tableHTML += '</tbody></table>';
            searchContent.innerHTML = tableHTML;
            searchResults.classList.add('show');
        };
    }

    // Authentication functions (existing code remains the same)
    function checkExistingAuth() {
        accessToken = localStorage.getItem('accessToken');
        refreshToken = localStorage.getItem('refreshToken');
        const storedUser = localStorage.getItem('currentUser');
        userCity = localStorage.getItem('userCity');

        if (accessToken && refreshToken && storedUser) {
            currentUser = JSON.parse(storedUser);
            authOverlay.style.display = 'none';
            showUserInfo();

            if (userCity) {
                loadWeatherForCity(userCity);
            } else {
                loadWeatherForCity('Delhi');
            }
        } else {
            loadWeatherForCity('Delhi');
        }
    }

    function showUserInfo() {
        if (currentUser) {
            document.getElementById('user-name')
            userInfo.style.display = 'flex';
        }
    }

    function showMessage(elementId, message, type = 'error') {
        const element = document.getElementById(elementId);
        element.innerHTML = `<div class="${type}-message">${message}</div>`;
    }

    function clearMessage(elementId) {
        document.getElementById(elementId).innerHTML = '';
    }

    // Form switching functions
    function showLoginForm() {
        loginForm.style.display = 'block';
        signupForm.style.display = 'none';
        otpForm.style.display = 'none';
        clearMessage('auth-message');
        clearMessage('signup-message');
        clearMessage('otp-message');
    }

    function showSignupForm() {
        loginForm.style.display = 'none';
        signupForm.style.display = 'block';
        otpForm.style.display = 'none';
        clearMessage('auth-message');
        clearMessage('signup-message');
        clearMessage('otp-message');
    }

    function showOtpForm(phone) {
        loginForm.style.display = 'none';
        signupForm.style.display = 'none';
        otpForm.style.display = 'block';
        document.getElementById('otp-phone-display').textContent = phone;
        currentPhone = phone;
        clearMessage('auth-message');
        clearMessage('signup-message');
        clearMessage('otp-message');
    }

    // Toggle analysis method
    function toggleAnalysisMethod(method) {
        currentAnalysisMethod = method;

        // Update button states
        document.getElementById('manual-toggle').classList.remove('active');
        document.getElementById('health-card-toggle').classList.remove('active');
        document.getElementById(`${method}-toggle`).classList.add('active');

        // Show/hide forms
        const manualForm = document.getElementById('manual-form');
        const healthCardForm = document.getElementById('health-card-form');

        if (method === 'manual') {
            manualForm.style.display = 'block';
            healthCardForm.style.display = 'none';
        } else {
            manualForm.style.display = 'none';
            healthCardForm.style.display = 'block';
        }

        // Clear any previous results
        const resultDiv = document.getElementById('result');
        resultDiv.style.display = 'none';
    }

    // Image preview function
    function previewImage(input, previewId) {
        const preview = document.getElementById(previewId);
        const previewImg = document.getElementById(previewId + '-img');

        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = function(e) {
                previewImg.src = e.target.result;
                preview.style.display = 'block';
            }
            reader.readAsDataURL(input.files[0]);
        }
    }

    // Remove image function
    function removeImage(inputId, previewId) {
        document.getElementById(inputId).value = '';
        document.getElementById(previewId).style.display = 'none';
    }

    // API functions (signup, sendOtp, verifyOtp, resendOtp, refreshAccessToken, logout - existing code remains the same)
    async function signup() {
        const name = document.getElementById('signup-name').value.trim();
        const phone = document.getElementById('signup-phone').value.trim();
        const city = document.getElementById('signup-city').value.trim();
        const area = document.getElementById('signup-area').value.trim();
        const local = document.getElementById('signup-local').value.trim();

        if (!name || !phone || !city) {
            showMessage('signup-message', 'Please fill in all required fields');
            return;
        }

        try {
            const response = await fetch(`${API_BASE_URL}/auth/signup`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    name: name,
                    phone: phone,
                    city: city,
                    area: area,
                    local: local
                })
            });

            const data = await response.json();

            if (response.ok) {
                userCity = city;
                localStorage.setItem('userCity', city);

                showMessage('signup-message', 'Account created successfully! You can now login.', 'success');
                setTimeout(() => {
                    showLoginForm();
                    document.getElementById('login-phone').value = phone;
                }, 2000);
            } else {
                showMessage('signup-message', data.message || 'Signup failed');
            }
        } catch (error) {
            showMessage('signup-message', 'Network error. Please try again.');
            console.error('Signup error:', error);
        }
    }

    async function sendOtp() {
        const phone = document.getElementById('login-phone').value.trim();

        if (!phone) {
            showMessage('auth-message', 'Please enter phone number');
            return;
        }

        try {
            const response = await fetch(`${API_BASE_URL}/auth/send-otp`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ phone: phone })
            });

            const data = await response.json();

            if (response.ok) {
                showMessage('auth-message', 'OTP sent successfully!', 'success');
                setTimeout(() => {
                    showOtpForm(phone);
                }, 1500);
            } else {
                showMessage('auth-message', data.message || 'Failed to send OTP');
            }
        } catch (error) {
            showMessage('auth-message', 'Network error. Please try again.');
            console.error('Send OTP error:', error);
        }
    }

    async function verifyOtp() {
        const otp = document.getElementById('otp-code').value.trim();

        if (!otp || otp.length !== 6) {
            showMessage('otp-message', 'Please enter valid 6-digit OTP');
            return;
        }

        try {
            const response = await fetch(`${API_BASE_URL}/auth/verify-otp`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    phone: currentPhone,
                    otp: otp
                })
            });

            const data = await response.json();

            if (response.ok) {
                accessToken = data.accessToken;
                refreshToken = data.refreshToken;
                currentUser = {
                    userId: data.userId,
                    phone: currentPhone,
                    name: data.name
                };

                localStorage.setItem('accessToken', accessToken);
                localStorage.setItem('refreshToken', refreshToken);
                localStorage.setItem('currentUser', JSON.stringify(currentUser));

                showMessage('otp-message', 'Login successful!', 'success');

                setTimeout(() => {
                    authOverlay.style.display = 'none';
                    showUserInfo();

                    if (userCity) {
                        loadWeatherForCity(userCity);
                    }
                }, 1500);
            } else {
                showMessage('otp-message', data.message || 'Invalid OTP');
            }
        } catch (error) {
            showMessage('otp-message', 'Network error. Please try again.');
            console.error('Verify OTP error:', error);
        }
    }

    async function resendOtp() {
        if (!currentPhone) {
            showMessage('otp-message', 'Phone number not found');
            return;
        }

        try {
            const response = await fetch(`${API_BASE_URL}/auth/send-otp`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ phone: currentPhone })
            });

            const data = await response.json();

            if (response.ok) {
                showMessage('otp-message', 'OTP resent successfully!', 'success');
            } else {
                showMessage('otp-message', data.message || 'Failed to resend OTP');
            }
        } catch (error) {
            showMessage('otp-message', 'Network error. Please try again.');
            console.error('Resend OTP error:', error);
        }
    }

    async function refreshAccessToken() {
        try {
            const response = await fetch(`${API_BASE_URL}/auth/refresh`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ refreshToken: refreshToken })
            });

            const data = await response.json();

            if (response.ok) {
                accessToken = data.accessToken;
                refreshToken = data.refreshToken;

                localStorage.setItem('accessToken', accessToken);
                localStorage.setItem('refreshToken', refreshToken);

                return true;
            } else {
                logout();
                return false;
            }
        } catch (error) {
            console.error('Refresh token error:', error);
            logout();
            return false;
        }
    }

    function logout() {
        accessToken = null;
        refreshToken = null;
        currentUser = null;
        currentPhone = null;

        localStorage.removeItem('accessToken');
        localStorage.removeItem('refreshToken');
        localStorage.removeItem('currentUser');

        userInfo.style.display = 'none';
        authOverlay.style.display = 'flex';
        showLoginForm();

        loadWeatherForCity('Delhi');
    }

    // Enhanced Weather Functions (existing code remains the same)
    async function loadWeatherForCity(cityName) {
        if (!cityName) return;

        updateWeatherWidget('loading', cityName);

        try {
            let weatherData;

            if (accessToken) {
                weatherData = await getAuthenticatedWeather(cityName);
            } else {
                weatherData = await getPublicWeather(cityName);
            }

            if (weatherData) {
                updateWeatherWidget('success', cityName, weatherData);
            } else {
                updateWeatherWidget('error', cityName, null, 'Weather data not available');
            }

        } catch (error) {
            console.error('Weather loading error:', error);
            updateWeatherWidget('error', cityName, null, error.message);
        }
    }

    async function getAuthenticatedWeather(cityName) {
        try {
            const response = await fetch(`${API_BASE_URL}/location?city=${encodeURIComponent(cityName)}`, {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${accessToken}`,
                    'Content-Type': 'application/json'
                }
            });

            if (response.status === 401) {
                const refreshed = await refreshAccessToken();
                if (refreshed) {
                    return await getAuthenticatedWeather(cityName);
                }
                throw new Error('Authentication failed');
            }

            if (response.ok) {
                const data = await response.text();

                if (data.startsWith('WEATHER_DATA|')) {
                    const parts = data.split('|');
                    return {
                        name: parts[1],
                        weather: [{
                            main: parts[2],
                            description: parts[3]
                        }],
                        main: {
                            temp: parseFloat(parts[4]) + 273.15,
                            humidity: parseInt(parts[5])
                        },
                        wind: {
                            speed: parseFloat(parts[6])
                        }
                    };
                } else {
                    return JSON.parse(data);
                }
            } else {
                throw new Error(`Weather API error: ${response.status}`);
            }
        } catch (error) {
            console.error('Authenticated weather error:', error);
            throw error;
        }
    }

    async function getPublicWeather(cityName) {
        return {
            name: cityName,
            weather: [{
                main: "Clear",
                description: "clear sky"
            }],
            main: {
                temp: 298.15,
                humidity: 65
            },
            wind: {
                speed: 2.5
            }
        };
    }

    function updateWeatherWidget(status, cityName, weatherData = null, errorMessage = null) {
        const cityElement = document.getElementById('weather-city-name');
        const contentElement = document.getElementById('floating-weather-content');

        cityElement.textContent = cityName || 'Unknown City';

        switch (status) {
            case 'loading':
                contentElement.innerHTML = `
                    <div class="weather-loading">
                        <i class="fas fa-spinner fa-spin"></i> Loading weather for ${cityName}...
                    </div>
                `;
                break;

            case 'success':
                if (weatherData && weatherData.main && weatherData.weather) {
                    const temp = Math.round(weatherData.main.temp - 273.15);
                    const humidity = weatherData.main.humidity;
                    const condition = weatherData.weather[0].main;
                    const windSpeed = weatherData.wind ? weatherData.wind.speed : 0;

                    contentElement.innerHTML = `
                        <p><i class="fas fa-temperature-high"></i> ${temp}Â°C</p>
                        <p><i class="fas fa-tint"></i> ${humidity}% Humidity</p>
                        <p><i class="fas fa-cloud"></i> ${condition}</p>
                        <p><i class="fas fa-wind"></i> ${windSpeed} m/s</p>
                    `;
                } else {
                    contentElement.innerHTML = `
                        <div class="weather-error">
                            <i class="fas fa-exclamation-circle"></i> Invalid weather data
                        </div>
                    `;
                }
                break;

            case 'error':
                contentElement.innerHTML = `
                    <div class="weather-error">
                        <i class="fas fa-exclamation-triangle"></i> ${errorMessage || 'Failed to load weather'}
                    </div>
                `;
                break;
        }
    }

    async function getWeatherForCity(city) {
        if (!city) {
            alert('Please enter a city name');
            return;
        }

        const resultDiv = document.getElementById('weather-result');
        const weatherDataDiv = document.getElementById('weather-data');

        weatherDataDiv.innerHTML = '<div class="weather-loading"><i class="fas fa-spinner fa-spin"></i> Loading weather data...</div>';
        resultDiv.style.display = 'block';
        resultDiv.scrollIntoView({ behavior: 'smooth' });

        try {
            let weatherData;

            if (accessToken) {
                weatherData = await getAuthenticatedWeather(city);
            } else {
                weatherData = await getPublicWeather(city);
            }

            displayWeatherData(weatherData);
            updateWeatherWidget('success', city, weatherData);

        } catch (error) {
            console.error('Weather API error:', error);
            weatherDataDiv.innerHTML = `
                <div class="weather-error">
                    <i class="fas fa-exclamation-triangle"></i> Failed to load weather data: ${error.message}
                </div>
            `;
        }
    }

    function displayWeatherData(data) {
        const weatherDiv = document.getElementById('weather-data');
        const resultDiv = document.getElementById('weather-result');

        if (data && data.weather && data.weather[0] && data.main) {
            const weather = data.weather[0];
            const main = data.main;
            const wind = data.wind || { speed: 0 };

            weatherDiv.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 20px;">
                    <div style="background: linear-gradient(135deg, #f0f7f0 0%, #e8f5e8 100%); padding: 20px; border-radius: 12px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                        <h4 style="color: var(--primary); margin-bottom: 10px;"><i class="fas fa-temperature-high"></i> Temperature</h4>
                        <p style="font-size: 2rem; color: var(--primary); font-weight: bold; margin: 0;">${Math.round(main.temp - 273.15)}Â°C</p>
                        <p style="color: #666; margin: 5px 0;">Feels like ${Math.round(main.feels_like - 273.15)}Â°C</p>
                    </div>
                    <div style="background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%); padding: 20px; border-radius: 12px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                        <h4 style="color: #1976d2; margin-bottom: 10px;"><i class="fas fa-cloud"></i> Conditions</h4>
                        <p style="font-size: 1.3rem; color: #1976d2; font-weight: bold; margin: 0;">${weather.main}</p>
                        <p style="color: #666; margin: 5px 0; text-transform: capitalize;">${weather.description}</p>
                    </div>
                    <div style="background: linear-gradient(135deg, #e8f5e8 0%, #c8e6c9 100%); padding: 20px; border-radius: 12px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                        <h4 style="color: #388e3c; margin-bottom: 10px;"><i class="fas fa-tint"></i> Humidity</h4>
                        <p style="font-size: 2rem; color: #388e3c; font-weight: bold; margin: 0;">${main.humidity}%</p>
                    </div>
                    <div style="background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%); padding: 20px; border-radius: 12px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                        <h4 style="color: #f57c00; margin-bottom: 10px;"><i class="fas fa-wind"></i> Wind</h4>
                        <p style="font-size: 2rem; color: #f57c00; font-weight: bold; margin: 0;">${wind.speed} m/s</p>
                    </div>
                    <div style="background: linear-gradient(135deg, #fce4ec 0%, #f8bbd9 100%); padding: 20px; border-radius: 12px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                        <h4 style="color: #c2185b; margin-bottom: 10px;"><i class="fas fa-gauge"></i> Pressure</h4>
                        <p style="font-size: 2rem; color: #c2185b; font-weight: bold; margin: 0;">${main.pressure} hPa</p>
                    </div>
                    <div style="background: linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%); padding: 20px; border-radius: 12px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                        <h4 style="color: #7b1fa2; margin-bottom: 10px;"><i class="fas fa-map-marker-alt"></i> Location</h4>
                        <p style="font-size: 1.3rem; color: #7b1fa2; font-weight: bold; margin: 0;">${data.name}</p>
                    </div>
                </div>
            `;
        } else {
            weatherDiv.innerHTML = `
                <div class="weather-error" style="text-align: center; padding: 20px;">
                    <i class="fas fa-exclamation-circle" style="font-size: 2rem; color: #f44336; margin-bottom: 10px;"></i>
                    <p>Weather data not available for this location</p>
                </div>
            `;
        }

        resultDiv.style.display = 'block';
        resultDiv.scrollIntoView({ behavior: 'smooth' });
    }

    // Initialize navigation
    function initializeNavigation() {
        const navLinks = document.querySelectorAll('.nav-link');
        const pages = document.querySelectorAll('.page');

        navLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const targetPage = this.getAttribute('data-page');

                pages.forEach(page => {
                    page.classList.remove('active');
                });

                document.getElementById(targetPage).classList.add('active');
                window.scrollTo(0, 0);
            });
        });

        const mobileMenuBtn = document.querySelector('.mobile-menu-btn');
        const navMenu = document.querySelector('.nav-menu');

        if (mobileMenuBtn && navMenu) {
            mobileMenuBtn.addEventListener('click', function() {
                navMenu.classList.toggle('active');
            });
        }
    }

    // Initialize forms
    function initializeForms() {
        const manualForm = document.getElementById('manual-form');
        if (manualForm) {
            manualForm.addEventListener('submit', handleManualForm);
        }

        const healthCardForm = document.getElementById('health-card-form');
        if (healthCardForm) {
            healthCardForm.addEventListener('submit', handleHealthCardForm);
        }

        const weatherForm = document.getElementById('weather-form');
        if (weatherForm) {
            weatherForm.addEventListener('submit', handleWeatherForm);
        }

        const chatForm = document.getElementById('chat-form');
        if (chatForm) {
            chatForm.addEventListener('submit', handleChatForm);
            chatSessionId = generateSessionId();
        }
    }

    // Generate session ID for chat
    function generateSessionId() {
        return 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
    }

    // Handle manual soil analysis form submission (existing code remains the same)
    async function handleManualForm(e) {
        e.preventDefault();

        const submitBtn = document.getElementById('manual-submit-btn');
        const resultDiv = document.getElementById('result');
        const adviceContent = document.getElementById('advice-content');

        // Get form data
        const cropType = document.getElementById('crop-type').value;
        const areaValue = parseFloat(document.getElementById('area-value').value);
        const areaUnit = document.getElementById('area-unit').value;
        const season = document.getElementById('season').value;
        const language = document.getElementById('language').value;
        const location = document.getElementById('location').value;
        const soilType = document.getElementById('soil-type-select').value;
        const soilImage = document.getElementById('soil-image').files[0];

        // Validate required fields
        if (!cropType || !areaValue || !areaUnit || !season || !language) {
            showError('Please fill all required fields marked with *');
            return;
        }

        // Show loading state
        submitBtn.innerHTML = '<span class="loading-spinner"></span>Processing with AI...';
        submitBtn.disabled = true;

        // Clear previous results
        resultDiv.style.display = 'none';
        adviceContent.innerHTML = '';

        // Show waiting message
        showWaitingMessage();

        try {
            // Prepare form data
            const formData = new FormData();
            formData.append('cropType', cropType);
            formData.append('areaValue', areaValue);
            formData.append('areaUnit', areaUnit);
            formData.append('season', season);
            formData.append('language', language);

            if (location && location.trim()) formData.append('location', location.trim());
            if (soilType && soilType.trim()) formData.append('soilType', soilType);
            if (soilImage) formData.append('soilImage', soilImage);

            console.log('Submitting manual form data to:', FERTILIZER_ANALYSIS_URL);

            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), 120000);

            const response = await fetch(FERTILIZER_ANALYSIS_URL, {
                method: 'POST',
                body: formData,
                signal: controller.signal
            });

            clearTimeout(timeoutId);
            console.log('Response status:', response.status);

            if (response.ok) {
                const recommendation = await response.json();
                showAIRecommendation(recommendation, {
                    cropType, areaValue, areaUnit, season, language,
                    location: location || null,
                    soilType: soilType || null,
                    hasImage: !!soilImage
                }, 'Manual analysis completed successfully');
            } else {
                const errorText = await response.text();
                let errorMessage = errorText || 'Unknown error occurred';

                try {
                    const errorJson = JSON.parse(errorText);
                    errorMessage = errorJson.message || errorJson.error || errorMessage;
                } catch (parseError) {
                    // Use raw text if not JSON
                }

                showError(`Server Error (${response.status}): ${errorMessage}`);
            }

        } catch (error) {
            console.error('Network error:', error);

            let errorMessage;
            if (error.name === 'AbortError') {
                errorMessage = 'Request timed out. The AI analysis is taking longer than expected. Please try again.';
            } else if (error.name === 'TypeError' && error.message.includes('fetch')) {
                errorMessage = `Connection failed: Cannot reach the analysis service at ${FERTILIZER_ANALYSIS_URL}. Please check if the backend server is running on port 8082.`;
            } else {
                errorMessage = `Network error: ${error.message}`;
            }

            showError(errorMessage);
        } finally {
            submitBtn.innerHTML = 'Get AI Soil Analysis';
            submitBtn.disabled = false;
        }
    }

    // Handle health card analysis form submission (existing code remains the same)
    async function handleHealthCardForm(e) {
        e.preventDefault();

        const submitBtn = document.getElementById('health-card-submit-btn');
        const resultDiv = document.getElementById('result');
        const adviceContent = document.getElementById('advice-content');

        // Get form data
        const healthCardImage = document.getElementById('health-card-image').files[0];
        const language = document.getElementById('health-card-language').value;
        const overrideCropType = document.getElementById('override-crop-type').value;
        const overrideAreaValue = document.getElementById('override-area-value').value;
        const overrideAreaUnit = document.getElementById('override-area-unit').value;
        const overrideSeason = document.getElementById('override-season').value;

        // Validate required fields
        if (!healthCardImage) {
            showError('Please upload your soil health card image');
            return;
        }

        if (!language) {
            showError('Please select a language');
            return;
        }

        // Show loading state
        submitBtn.innerHTML = '<span class="loading-spinner"></span>Analyzing Health Card...';
        submitBtn.disabled = true;

        // Clear previous results
        resultDiv.style.display = 'none';
        adviceContent.innerHTML = '';

        // Show waiting message for health card
        showHealthCardWaitingMessage();

        try {
            // Prepare form data
            const formData = new FormData();
            formData.append('healthCardImage', healthCardImage);
            formData.append('language', language);

            // Add override values if provided
            if (overrideCropType && overrideCropType.trim()) {
                formData.append('overrideCropType', overrideCropType.trim());
            }
            if (overrideAreaValue && parseFloat(overrideAreaValue) > 0) {
                formData.append('overrideAreaValue', parseFloat(overrideAreaValue));
            }
            if (overrideAreaUnit && overrideAreaUnit.trim()) {
                formData.append('overrideAreaUnit', overrideAreaUnit.trim());
            }
            if (overrideSeason && overrideSeason.trim()) {
                formData.append('overrideSeason', overrideSeason.trim());
            }

            console.log('Submitting health card form data to:', HEALTH_CARD_ANALYSIS_URL);

            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), 120000);

            const response = await fetch(HEALTH_CARD_ANALYSIS_URL, {
                method: 'POST',
                body: formData,
                signal: controller.signal
            });

            clearTimeout(timeoutId);
            console.log('Health card response status:', response.status);

            if (response.ok) {
                const recommendation = await response.json();
                showHealthCardRecommendation(recommendation);
            } else {
                const errorText = await response.text();
                let errorMessage = errorText || 'Unknown error occurred';

                try {
                    const errorJson = JSON.parse(errorText);
                    errorMessage = errorJson.message || errorJson.error || errorMessage;
                } catch (parseError) {
                    // Use raw text if not JSON
                }

                showError(`Health Card Analysis Error (${response.status}): ${errorMessage}`);
            }

        } catch (error) {
            console.error('Health card analysis error:', error);

            let errorMessage;
            if (error.name === 'AbortError') {
                errorMessage = 'Health card analysis timed out. The AI is taking longer than expected. Please try again with a clearer image.';
            } else if (error.name === 'TypeError' && error.message.includes('fetch')) {
                errorMessage = `Connection failed: Cannot reach the health card analysis service at ${HEALTH_CARD_ANALYSIS_URL}. Please check if the backend server is running on port 8082.`;
            } else {
                errorMessage = `Network error: ${error.message}`;
            }

            showError(errorMessage);
        } finally {
            submitBtn.innerHTML = '<i class="fas fa-magic"></i> Analyze Health Card with AI';
            submitBtn.disabled = false;
        }
    }

    // Show health card waiting message
    function showHealthCardWaitingMessage() {
        const resultDiv = document.getElementById('result');
        const adviceContent = document.getElementById('advice-content');

        const waitingHtml = `
            <div class="waiting-message pulse-animation">
                <div class="loading-spinner" style="display: inline-block; margin-right: 15px;"></div>
                <h4><i class="fas fa-id-card"></i> AI Health Card Analysis in Progress</h4>
                <p>Our advanced AI is extracting data from your soil health card and generating personalized recommendations...</p>

                <div class="processing-steps">
                    <div class="processing-step">
                        <i class="fas fa-image"></i>
                        <p style="margin: 0; font-size: 0.9em;">Reading Image</p>
                    </div>
                    <div class="processing-step">
                        <i class="fas fa-search"></i>
                        <p style="margin: 0; font-size: 0.9em;">Extracting Data</p>
                    </div>
                    <div class="processing-step">
                        <i class="fas fa-calculator"></i>
                        <p style="margin: 0; font-size: 0.9em;">Analyzing NPK</p>
                    </div>
                    <div class="processing-step">
                        <i class="fas fa-flask"></i>
                        <p style="margin: 0; font-size: 0.9em;">Recommending</p>
                    </div>
                </div>

                <p style="font-size: 0.9em; color: #666; margin-top: 15px;">
                    The AI is processing your soil health card data including soil type, nutrient levels, pH, and other parameters to provide the most accurate fertilizer recommendations.
                </p>
            </div>
        `;

        adviceContent.innerHTML = waitingHtml;
        resultDiv.style.display = 'block';
        resultDiv.scrollIntoView({ behavior: 'smooth' });
    }

    // Show health card recommendation
    function showHealthCardRecommendation(recommendation) {
        const resultDiv = document.getElementById('result');
        const adviceContent = document.getElementById('advice-content');

        const healthCardHtml = `
            <div class="success-message">
                <h4><i class="fas fa-check-circle"></i> Health Card Analysis Complete!</h4>
                <p>AI has successfully extracted and analyzed your soil health card data</p>
            </div>

            <div class="analysis-result">
                <h4><i class="fas fa-id-card"></i> Extracted Soil Health Card Data</h4>
                <div class="fertilizer-card">
                    <h6><i class="fas fa-seedling"></i> Detected Crop Type</h6>
                    <p>${recommendation.cropType}</p>
                </div>

                <div class="fertilizer-card">
                    <h6><i class="fas fa-microscope"></i> Soil Analysis</h6>
                    <p><strong>Soil Type:</strong> ${recommendation.detectedSoilType}</p>
                    <p><strong>Area:</strong> ${recommendation.areaValue} ${recommendation.areaUnit.toLowerCase()}</p>
                    <p><strong>Season:</strong> ${recommendation.season}</p>
                </div>

                <div class="fertilizer-card">
                    <h6><i class="fas fa-lightbulb"></i> General Recommendation</h6>
                    <p>${recommendation.generalRecommendation}</p>
                </div>
            </div>

            <div class="analysis-result">
                <h4><i class="fas fa-flask"></i> Personalized Fertilizer Recommendations</h4>
                ${recommendation.fertilizers.map(fertilizer => `
                    <div class="fertilizer-card">
                        <h6>${fertilizer.name} (${fertilizer.npkRatio})</h6>
                        <p><strong>Company:</strong> ${fertilizer.company}</p>
                        <p><strong>Quantity:</strong> ${fertilizer.quantity}</p>
                        <p><strong>Application Method:</strong> ${fertilizer.applicationMethod}</p>
                        <p><strong>Benefits:</strong> ${fertilizer.benefits || 'Improves soil nutrient balance'}</p>
                    </div>
                `).join('')}
            </div>

            <div class="analysis-result">
                <div class="recommendation-section">
                    <h5><i class="fas fa-tips"></i> Application Tips</h5>
                    <ul>
                        ${recommendation.applicationTips.map(tip => `<li>${tip}</li>`).join('')}
                    </ul>
                </div>
            </div>

            <div class="analysis-result">
                <div class="recommendation-section">
                    <h5><i class="fas fa-calendar-alt"></i> Seasonal Advice</h5>
                    <ul>
                        ${recommendation.seasonalAdvice.map(advice => `<li>${advice}</li>`).join('')}
                    </ul>
                </div>
            </div>

            <div class="analysis-result">
                <div class="recommendation-section">
                    <h5><i class="fas fa-bug"></i> Pesticide & Disease Management</h5>
                    <ul>
                        ${recommendation.pesticideRecommendation.map(pest => `<li>${pest}</li>`).join('')}
                    </ul>
                </div>
            </div>

            <div class="analysis-result">
                <h4><i class="fas fa-info-circle"></i> Health Card Analysis Summary</h4>
                <div style="background: white; padding: 15px; border-radius: 8px;">
                    <p><strong>Analysis Method:</strong> AI-powered soil health card extraction</p>
                    <p><strong>Data Source:</strong> Government-issued soil health card</p>
                    <p><strong>Language:</strong> ${recommendation.language}</p>
                    <p><strong>Generated:</strong> ${new Date().toLocaleString()}</p>
                    <p><strong>Accuracy:</strong> Based on official soil test parameters</p>
                </div>
            </div>

            <div style="background: #e8f5e8; padding: 15px; border-radius: 8px; margin-top: 15px;">
                <h5><i class="fas fa-lightbulb"></i> Next Steps:</h5>
                <ul style="margin: 10px 0; padding-left: 20px;">
                    <li>Purchase recommended fertilizers from authorized dealers</li>
                    <li>Follow the application schedule and methods provided</li>
                    <li>Monitor crop growth and soil conditions</li>
                    <li>Consult local agricultural extension officers if needed</li>
                    <li>Keep your soil health card updated with regular testing</li>
                </ul>
            </div>
        `;

        adviceContent.innerHTML = healthCardHtml;
        resultDiv.style.display = 'block';
        resultDiv.scrollIntoView({ behavior: 'smooth' });
    }

    // Show waiting message while processing
    function showWaitingMessage() {
        const resultDiv = document.getElementById('result');
        const adviceContent = document.getElementById('advice-content');

        const waitingHtml = `
            <div class="waiting-message pulse-animation">
                <div class="loading-spinner" style="display: inline-block; margin-right: 15px;"></div>
                <h4><i class="fas fa-robot"></i> AI Analysis in Progress</h4>
                <p>Our AI system is analyzing your soil and crop data. This may take 30-90 seconds...</p>

                <div class="processing-steps">
                    <div class="processing-step">
                        <i class="fas fa-microscope"></i>
                        <p style="margin: 0; font-size: 0.9em;">Analyzing Soil</p>
                    </div>
                    <div class="processing-step">
                        <i class="fas fa-seedling"></i>
                        <p style="margin: 0; font-size: 0.9em;">Crop Requirements</p>
                    </div>
                    <div class="processing-step">
                        <i class="fas fa-flask"></i>
                        <p style="margin: 0; font-size: 0.9em;">Fertilizer Matching</p>
                    </div>
                    <div class="processing-step">
                        <i class="fas fa-chart-line"></i>
                        <p style="margin: 0; font-size: 0.9em;">Recommendations</p>
                    </div>
                </div>

                <p style="font-size: 0.9em; color: #666; margin-top: 15px;">
                    Please wait while our AI processes your request. The system is analyzing multiple factors to provide the most accurate recommendations.
                </p>
            </div>
        `;

        adviceContent.innerHTML = waitingHtml;
        resultDiv.style.display = 'block';
        resultDiv.scrollIntoView({ behavior: 'smooth' });
    }

    // Show AI recommendation
    function showAIRecommendation(recommendation, inputData, producerResponse) {
        const resultDiv = document.getElementById('result');
        const adviceContent = document.getElementById('advice-content');

        const aiHtml = `
            <div class="success-message">
                <h4><i class="fas fa-check-circle"></i> AI Soil Analysis Complete!</h4>
                <p>Your personalized fertilizer recommendations are ready</p>
            </div>

            <div class="analysis-result">
                <h4><i class="fas fa-seedling"></i> Soil Analysis Results</h4>
                <div class="fertilizer-card">
                    <h6><i class="fas fa-microscope"></i> Detected Soil Type</h6>
                    <p>${recommendation.detectedSoilType}</p>
                </div>

                <div class="fertilizer-card">
                    <h6><i class="fas fa-lightbulb"></i> General Recommendation</h6>
                    <p>${recommendation.generalRecommendation}</p>
                </div>
            </div>

            <div class="analysis-result">
                <h4><i class="fas fa-flask"></i> Fertilizer Recommendations</h4>
                ${recommendation.fertilizers.map(fertilizer => `
                    <div class="fertilizer-card">
                        <h6>${fertilizer.name} (${fertilizer.npkRatio})</h6>
                        <p><strong>Company:</strong> ${fertilizer.company}</p>
                        <p><strong>Quantity:</strong> ${fertilizer.quantity}</p>
                        <p><strong>Application Method:</strong> ${fertilizer.applicationMethod}</p>
                    </div>
                `).join('')}
            </div>

            <div class="analysis-result">
                <div class="recommendation-section">
                    <h5><i class="fas fa-tips"></i> Application Tips</h5>
                    <ul>
                        ${recommendation.applicationTips.map(tip => `<li>${tip}</li>`).join('')}
                    </ul>
                </div>
            </div>

            <div class="analysis-result">
                <div class="recommendation-section">
                    <h5><i class="fas fa-calendar-alt"></i> Seasonal Advice</h5>
                    <ul>
                        ${recommendation.seasonalAdvice.map(advice => `<li>${advice}</li>`).join('')}
                    </ul>
                </div>
            </div>

            <div class="analysis-result">
                <div class="recommendation-section">
                    <h5><i class="fas fa-bug"></i> Pesticide Recommendations</h5>
                    <ul>
                        ${recommendation.pesticideRecommendation.map(pest => `<li>${pest}</li>`).join('')}
                    </ul>
                </div>
            </div>

            <div class="analysis-result">
                <h4><i class="fas fa-info-circle"></i> Your Request Details</h4>
                <div style="background: white; padding: 15px; border-radius: 8px;">
                    <p><strong>Crop:</strong> ${inputData.cropType}</p>
                    <p><strong>Area:</strong> ${inputData.areaValue} ${inputData.areaUnit.toLowerCase()}</p>
                    <p><strong>Season:</strong> ${inputData.season}</p>
                    <p><strong>Language:</strong> ${inputData.language}</p>
                    <p><strong>Location:</strong> ${inputData.location || 'Not provided'}</p>
                    <p><strong>Soil Type:</strong> ${inputData.soilType || 'Detected by AI'}</p>
                    <p><strong>Image Analysis:</strong> ${inputData.hasImage ? 'Yes' : 'No'}</p>
                </div>
            </div>
        `;

        adviceContent.innerHTML = aiHtml;
        resultDiv.style.display = 'block';
        resultDiv.scrollIntoView({ behavior: 'smooth' });
    }

    // Show error message
    function showError(errorMessage) {
        const resultDiv = document.getElementById('result');
        const adviceContent = document.getElementById('advice-content');

        const errorHtml = `
            <div class="error-message">
                <h4><i class="fas fa-exclamation-triangle"></i> Analysis Error</h4>
                <pre style="white-space: pre-line; font-family: inherit;">${errorMessage}</pre>
            </div>

            <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; border-left: 4px solid #2196f3; margin-top: 15px;">
                <h5><i class="fas fa-tools"></i> Troubleshooting Steps:</h5>
                <ol style="margin: 10px 0; padding-left: 20px;">
                    <li><strong>Backend Server:</strong> Ensure your backend server is running on port 8082</li>
                    <li><strong>CORS Configuration:</strong> Add proper CORS configuration to your backend</li>
                    <li><strong>Image Quality:</strong> For health card analysis, ensure the image is clear and readable</li>
                    <li><strong>Network:</strong> Check your internet connection and firewall settings</li>
                    <li><strong>Browser Console:</strong> Check browser developer tools (F12) for detailed errors</li>
                </ol>
            </div>

            <div style="background: #f0f7f0; padding: 15px; border-radius: 8px; margin-top: 15px;">
                <h5><i class="fas fa-lightbulb"></i> Alternative Options:</h5>
                <ul style="margin: 10px 0; padding-left: 20px;">
                    <li><strong>Try Manual Entry:</strong> If health card analysis fails, use manual entry method</li>
                    <li><strong>Use Chatbot:</strong> Get general farming advice from our AI chatbot</li>
                    <li><strong>Contact Support:</strong> Reach out to our technical support team</li>
                </ul>
            </div>
        `;

        adviceContent.innerHTML = errorHtml;
        resultDiv.style.display = 'block';
        resultDiv.scrollIntoView({ behavior: 'smooth' });
    }

    // Handle chatbot form submission (existing code remains the same)
    async function handleChatForm(e) {
        e.preventDefault();

        const messageInput = document.getElementById('chat-input');
        const imageInput = document.getElementById('chat-image');
        const languageSelect = document.getElementById('chat-language');
        const message = messageInput.value.trim();
        const image = imageInput.files[0];
        const language = languageSelect.value || 'en';

        if (!message && !image) {
            alert('Please enter a message or upload an image');
            return;
        }

        // Add user message to chat
        addChatMessage(message, true, image);

        // Clear inputs
        messageInput.value = '';
        imageInput.value = '';

        // Show typing indicator
        showTypingIndicator();

        try {
            const formData = new FormData();
            formData.append('message', message || 'Please analyze this image');
            formData.append('sessionId', chatSessionId);
            formData.append('language', language);
            if (image) formData.append('image', image);

            console.log('Sending chat request with language:', language);

            const response = await fetch(CHATBOT_URL, {
                method: 'POST',
                body: formData
            });

            const data = await response.json();

            hideTypingIndicator();

            if (data.success) {
                addChatMessage(data.message, false);
            } else {
                const errorMessage = getLocalizedErrorMessage(language, 'general');
                addChatMessage(errorMessage, false);
            }

        } catch (error) {
            console.error('Chatbot error:', error);
            hideTypingIndicator();
            const errorMessage = getLocalizedErrorMessage(language, 'connection');
            addChatMessage(errorMessage, false);
        }
    }

    // Get localized error messages for the frontend
    function getLocalizedErrorMessage(language, errorType) {
        const messages = {
            'en': {
                general: 'Sorry, I had trouble processing your request. Please try again with a farming-related question.',
                connection: 'Connection error. Please check your internet connection and try again.'
            },
            'hi': {
                general: 'à¤–à¥à¤¶à¥€, à¤®à¥à¤à¥‡ à¤†à¤ªà¤•à¥‡ à¤…à¤¨à¥à¤°à¥‹à¤§ à¤•à¥‹ à¤¸à¤‚à¤¸à¤¾à¤§à¤¿à¤¤ à¤•à¤°à¤¨à¥‡ à¤®à¥‡à¤‚ à¤ªà¤°à¥‡à¤¶à¤¾à¤¨à¥€ à¤¹à¥à¤ˆà¥¤ à¤•à¥ƒà¤ªà¤¯à¤¾ à¤–à¥‡à¤¤à¥€ à¤¸à¤‚à¤¬à¤‚à¤§à¥€ à¤ªà¥à¤°à¤¶à¥à¤¨ à¤•à¥‡ à¤¸à¤¾à¤¥ à¤ªà¥à¤¨à¤ƒ à¤ªà¥à¤°à¤¯à¤¾à¤¸ à¤•à¤°à¥‡à¤‚à¥¤',
                connection: 'à¤•à¤¨à¥‡à¤•à¥à¤¶à¤¨ à¤¤à¥à¤°à¥à¤Ÿà¤¿à¥¤ à¤•à¥ƒà¤ªà¤¯à¤¾ à¤…à¤ªà¤¨à¤¾ à¤‡à¤‚à¤Ÿà¤°à¤¨à¥‡à¤Ÿ à¤•à¤¨à¥‡à¤•à¥à¤¶à¤¨ à¤œà¤¾à¤‚à¤šà¥‡à¤‚ à¤”à¤° à¤ªà¥à¤¨à¤ƒ à¤ªà¥à¤°à¤¯à¤¾à¤¸ à¤•à¤°à¥‡à¤‚à¥¤'
            },
            'bn': {
                general: 'à¦¦à§à¦ƒà¦–à¦¿à¦¤, à¦†à¦®à¦¾à¦° à¦†à¦ªà¦¨à¦¾à¦° à¦…à¦¨à§à¦°à§‹à¦§ à¦ªà§à¦°à¦•à§à¦°à¦¿à¦¯à¦¼à¦¾ à¦•à¦°à¦¤à§‡ à¦¸à¦®à¦¸à§à¦¯à¦¾ à¦¹à¦¯à¦¼à§‡à¦›à§‡à¥¤ à¦¦à¦¯à¦¼à¦¾ à¦•à¦°à§‡ à¦•à§ƒà¦·à¦¿ à¦¸à¦®à§à¦ªà¦°à§à¦•à¦¿à¦¤ à¦ªà§à¦°à¦¶à§à¦¨ à¦¦à¦¿à¦¯à¦¼à§‡ à¦†à¦¬à¦¾à¦° à¦šà§‡à¦·à§à¦Ÿà¦¾ à¦•à¦°à§à¦¨à¥¤',
                connection: 'à¦¸à¦‚à¦¯à§‹à¦—à§‡à¦° à¦¤à§à¦°à§à¦Ÿà¦¿à¥¤ à¦¦à¦¯à¦¼à¦¾ à¦•à¦°à§‡ à¦†à¦ªà¦¨à¦¾à¦° à¦‡à¦¨à§à¦Ÿà¦¾à¦°à¦¨à§‡à¦Ÿ à¦¸à¦‚à¦¯à§‹à¦— à¦ªà¦°à§€à¦•à§à¦·à¦¾ à¦•à¦°à§à¦¨ à¦à¦¬à¦‚ à¦†à¦¬à¦¾à¦° à¦šà§‡à¦·à§à¦Ÿà¦¾ à¦•à¦°à§à¦¨à¥¤'
            },
            'te': {
                general: 'à°•à±à°·à°®à°¿à°‚à°šà°‚à°¡à°¿, à°®à±€ à°…à°­à±à°¯à°°à±à°¥à°¨à°¨à± à°ªà±à°°à°¾à°¸à±†à°¸à± à°šà±‡à°¯à°¡à°‚à°²à±‹ à°¨à°¾à°•à± à°‡à°¬à±à°¬à°‚à°¦à°¿ à°µà°šà±à°šà°¿à°‚à°¦à°¿à¥¤ à°¦à°¯à°šà±‡à°¸à°¿ à°µà±à°¯à°µà°¸à°¾à°¯ à°¸à°‚à°¬à°‚à°§à°¿à°¤ à°ªà±à°°à°¶à±à°¨à°¤à±‹ à°®à°³à±à°²à±€ à°ªà±à°°à°¯à°¤à±à°¨à°¿à°‚à°šà°‚à°¡à°¿à¥¤',
                connection: 'à°•à°¨à±†à°•à±à°·à°¨à± à°²à±‹à°ªà°‚. à°¦à°¯à°šà±‡à°¸à°¿ à°®à±€ à°‡à°‚à°Ÿà°°à±à°¨à±†à°Ÿà± à°•à°¨à±†à°•à±à°·à°¨à±à°¨à°¿ à°¤à°¨à°¿à°–à±€ à°šà±‡à°¸à°¿ à°®à°³à±à°²à±€ à°ªà±à°°à°¯à°¤à±à°¨à°¿à°‚à°šà°‚à°¡à°¿à¥¤'
            },
            'ta': {
                general: 'à®®à®©à¯à®©à®¿à®•à¯à®•à®µà¯à®®à¯, à®‰à®™à¯à®•à®³à¯ à®•à¯‹à®°à®¿à®•à¯à®•à¯ˆà®¯à¯ˆ à®šà¯†à®¯à®²à®¾à®•à¯à®•à¯à®µà®¤à®¿à®²à¯ à®Žà®©à®•à¯à®•à¯ à®šà®¿à®°à®®à®®à¯ à®à®±à¯à®ªà®Ÿà¯à®Ÿà®¤à¯à¥¤ à®µà®¿à®µà®šà®¾à®¯à®®à¯ à®¤à¯Šà®Ÿà®°à¯à®ªà®¾à®© à®•à¯‡à®³à¯à®µà®¿à®¯à¯à®Ÿà®©à¯ à®®à¯€à®£à¯à®Ÿà¯à®®à¯ à®®à¯à®¯à®±à¯à®šà®¿à®•à¯à®•à®µà¯à®®à¯.',
                connection: 'à®‡à®£à¯ˆà®ªà¯à®ªà¯ à®ªà®¿à®´à¯ˆ. à®‰à®™à¯à®•à®³à¯ à®‡à®£à¯ˆà®¯ à®‡à®£à¯ˆà®ªà¯à®ªà¯ˆà®šà¯ à®šà®°à®¿à®ªà®¾à®°à¯à®¤à¯à®¤à¯ à®®à¯€à®£à¯à®Ÿà¯à®®à¯ à®®à¯à®¯à®±à¯à®šà®¿à®•à¯à®•à®µà¯à®®à¯.'
            },
            'mr': {
                general: 'à¤•à¥à¤·à¤®à¤¸à¥à¤µ, à¤¤à¥à¤®à¤šà¥€ à¤µà¤¿à¤¨à¤‚à¤¤à¥€ à¤ªà¥à¤°à¤•à¥à¤°à¤¿à¤¯à¤¾ à¤•à¤°à¤£à¥à¤¯à¤¾à¤¤ à¤®à¤²à¤¾ à¤…à¤¡à¤šà¤£ à¤†à¤²à¥€. à¤•à¥ƒà¤ªà¤¯à¤¾ à¤¶à¥‡à¤¤à¥€à¤¶à¥€ à¤¸à¤‚à¤¬à¤‚à¤§à¤¿à¤¤ à¤ªà¥à¤°à¤¶à¥à¤¨à¤¾à¤¸à¤¹ à¤ªà¥à¤¨à¥à¤¹à¤¾ à¤ªà¥à¤°à¤¯à¤¤à¥à¤¨ à¤•à¤°à¤¾.',
                connection: 'à¤•à¤¨à¥‡à¤•à¥à¤¶à¤¨ à¤¤à¥à¤°à¥à¤Ÿà¥€. à¤•à¥ƒà¤ªà¤¯à¤¾ à¤¤à¥à¤®à¤šà¥‡ à¤‡à¤‚à¤Ÿà¤°à¤¨à¥‡à¤Ÿ à¤•à¤¨à¥‡à¤•à¥à¤¶à¤¨ à¤¤à¤ªà¤¾à¤¸à¤¾ à¤†à¤£à¤¿ à¤ªà¥à¤¨à¥à¤¹à¤¾ à¤ªà¥à¤°à¤¯à¤¤à¥à¤¨ à¤•à¤°à¤¾.'
            },
            'gu': {
                general: 'àª®àª¾àª« àª•àª°àª¶à«‹, àª®àª¨à«‡ àª¤àª®àª¾àª°à«€ àªµàª¿àª¨àª‚àª¤à«€ àªªà«àª°àª•à«àª°àª¿àª¯àª¾ àª•àª°àªµàª¾àª®àª¾àª‚ àª®à«àª¶à«àª•à«‡àª²à«€ àªªàª¡à«€. àª•à«ƒàªªàª¾ àª•àª°à«€àª¨à«‡ àª–à«‡àª¤à«€ àª¸àª‚àª¬àª‚àª§àª¿àª¤ àªªà«àª°àª¶à«àª¨ àª¸àª¾àª¥à«‡ àª«àª°à«€ àªªà«àª°àª¯àª¾àª¸ àª•àª°à«‹.',
                connection: 'àª•àª¨à«‡àª•à«àª¶àª¨ àª­à«‚àª². àª•à«ƒàªªàª¾ àª•àª°à«€àª¨à«‡ àª¤àª®àª¾àª°à«àª‚ àª‡àª¨à«àªŸàª°àª¨à«‡àªŸ àª•àª¨à«‡àª•à«àª¶àª¨ àª¤àªªàª¾àª¸à«‹ àª…àª¨à«‡ àª«àª°à«€ àªªà«àª°àª¯àª¾àª¸ àª•àª°à«‹.'
            },
            'kn': {
                general: 'à²•à³à²·à²®à²¿à²¸à²¿, à²¨à²¿à²®à³à²® à²µà²¿à²¨à²‚à²¤à²¿à²¯à²¨à³à²¨à³ à²ªà³à²°à²•à³à²°à²¿à²¯à³†à²—à³Šà²³à²¿à²¸à³à²µà²²à³à²²à²¿ à²¨à²¨à²—à³† à²¤à³Šà²‚à²¦à²°à³†à²¯à²¾à²¯à²¿à²¤à³. à²¦à²¯à²µà²¿à²Ÿà³à²Ÿà³ à²•à³ƒà²·à²¿ à²¸à²‚à²¬à²‚à²§à²¿à²¤ à²ªà³à²°à²¶à³à²¨à³†à²¯à³Šà²‚à²¦à²¿à²—à³† à²®à²¤à³à²¤à³† à²ªà³à²°à²¯à²¤à³à²¨à²¿à²¸à²¿.',
                connection: 'à²•à²¨à³†à²•à³à²·à²¨à³ à²¦à³‹à²·. à²¦à²¯à²µà²¿à²Ÿà³à²Ÿà³ à²¨à²¿à²®à³à²® à²‡à²‚à²Ÿà²°à³à²¨à³†à²Ÿà³ à²¸à²‚à²ªà²°à³à²•à²µà²¨à³à²¨à³ à²ªà²°à²¿à²¶à³€à²²à²¿à²¸à²¿ à²®à²¤à³à²¤à³† à²ªà³à²°à²¯à²¤à³à²¨à²¿à²¸à²¿.'
            },
            'ml': {
                general: 'à´•àµà´·à´®à´¿à´•àµà´•à´£à´‚, à´¨à´¿à´™àµà´™à´³àµà´Ÿàµ† à´…à´­àµà´¯àµ¼à´¤àµà´¥à´¨ à´ªàµà´°àµ‹à´¸à´¸àµà´¸àµ à´šàµ†à´¯àµà´¯àµà´¨àµà´¨à´¤à´¿àµ½ à´Žà´¨à´¿à´•àµà´•àµ à´ªàµà´°à´¶àµâ€Œà´¨à´®àµà´£àµà´Ÿà´¾à´¯à´¿. à´¦à´¯à´µà´¾à´¯à´¿ à´•à´¾àµ¼à´·à´¿à´• à´µà´¿à´·à´¯à´µàµà´®à´¾à´¯à´¿ à´¬à´¨àµà´§à´ªàµà´ªàµ†à´Ÿàµà´Ÿ à´šàµ‹à´¦àµà´¯à´µàµà´®à´¾à´¯à´¿ à´µàµ€à´£àµà´Ÿàµà´‚ à´¶àµà´°à´®à´¿à´•àµà´•àµà´•.',
                connection: 'à´•à´£à´•àµà´·àµ» à´ªà´¿à´¶à´•àµ. à´¨à´¿à´™àµà´™à´³àµà´Ÿàµ† à´‡à´¨àµà´±àµ¼à´¨àµ†à´±àµà´±àµ à´•à´£à´•àµà´·àµ» à´ªà´°à´¿à´¶àµ‹à´§à´¿à´šàµà´šàµ à´µàµ€à´£àµà´Ÿàµà´‚ à´¶àµà´°à´®à´¿à´•àµà´•àµà´•.'
            },
            'pa': {
                general: 'à¨®à¨¾à¨«à¨¼ à¨•à¨°à¨¨à¨¾, à¨®à©ˆà¨¨à©‚à©° à¨¤à©à¨¹à¨¾à¨¡à©€ à¨¬à©‡à¨¨à¨¤à©€ à¨¨à©‚à©° à¨ªà©à¨°à©‹à¨¸à©ˆà¨¸ à¨•à¨°à¨¨ à¨µà¨¿à©±à¨š à¨®à©à¨¸à¨¼à¨•à¨¿à¨² à¨¹à©‹à¨ˆà¥¤ à¨•à¨¿à¨°à¨ªà¨¾ à¨•à¨°à¨•à©‡ à¨–à©‡à¨¤à©€ à¨¨à¨¾à¨² à¨¸à¨¬à©°à¨§à¨¤ à¨¸à¨µà¨¾à¨² à¨¨à¨¾à¨² à¨¦à©à¨¬à¨¾à¨°à¨¾ à¨•à©‹à¨¸à¨¼à¨¿à¨¸à¨¼ à¨•à¨°à©‹à¥¤',
                connection: 'à¨•à¨¨à©ˆà¨•à¨¸à¨¼à¨¨ à¨—à¨²à¨¤à©€. à¨†à¨ªà¨£à©‡ à¨‡à©°à¨Ÿà¨°à¨¨à©ˆà©±à¨Ÿ à¨•à¨¨à©ˆà¨•à¨¸à¨¼à¨¨ à¨¨à©‚à©° à¨šà©ˆà©±à¨• à¨•à¨°à©‹ à¨…à¨¤à©‡ à¨¦à©à¨¬à¨¾à¨°à¨¾ à¨•à©‹à¨¸à¨¼à¨¿à¨¸à¨¼ à¨•à¨°à©‹.'
            },
            'or': {
                general: 'à¬¦à­à¬ƒà¬–à¬¿à¬¤, à¬†à¬ªà¬£à¬™à­à¬•à¬° à¬…à¬¨à­à¬°à­‹à¬§ à¬ªà­à¬°à¬•à­à¬°à¬¿à­Ÿà¬¾à¬•à¬°à¬£à¬°à­‡ à¬®à­‹à¬° à¬…à¬¸à­à¬¬à¬¿à¬§à¬¾ à¬¹à­‡à¬²à¬¾à¥¤ à¬¦à­Ÿà¬¾à¬•à¬°à¬¿ à¬•à­ƒà¬·à¬¿ à¬¸à¬®à­à¬¬à¬¨à­à¬§à­€à­Ÿ à¬ªà­à¬°à¬¶à­à¬¨ à¬¸à¬¹à¬¿à¬¤ à¬ªà­à¬¨à¬°à­à¬¬à¬¾à¬° à¬šà­‡à¬·à­à¬Ÿà¬¾ à¬•à¬°à¬¨à­à¬¤à­à¥¤',
                connection: 'à¬¸à¬‚à¬¯à­‹à¬— à¬¤à­à¬°à­à¬Ÿà¬¿à¥¤ à¬†à¬ªà¬£à¬™à­à¬•à¬° à¬‡à¬£à­à¬Ÿà¬°à¬¨à­‡à¬Ÿà­ à¬¸à¬‚à¬¯à­‹à¬— à¬¯à¬¾à¬žà­à¬š à¬•à¬°à¬¨à­à¬¤à­ à¬à¬¬à¬‚ à¬ªà­à¬¨à¬°à­à¬¬à¬¾à¬° à¬šà­‡à¬·à­à¬Ÿà¬¾ à¬•à¬°à¬¨à­à¬¤à­à¥¤'
            }
        };

        // Default to English if language not found
        const langMessages = messages[language] || messages['en'];
        return langMessages[errorType] || langMessages.general;
    }

    // Update the welcome message based on selected language
    function updateWelcomeMessage() {
        const language = document.getElementById('chat-language').value;

        const welcomeMessages = {
            'en': 'Hello! I\'m your AI agriculture assistant. Ask me about crops, soil, fertilizers, pest control, or any farming-related questions. I can also analyze images of your plants or soil!',
            'hi': 'à¤¨à¤®à¤¸à¥à¤¤à¥‡! à¤®à¥ˆà¤‚ à¤†à¤ªà¤•à¤¾ AI à¤•à¥ƒà¤·à¤¿ à¤¸à¤¹à¤¾à¤¯à¤• à¤¹à¥‚à¤‚à¥¤ à¤®à¥à¤à¤¸à¥‡ à¤«à¤¸à¤², à¤®à¤¿à¤Ÿà¥à¤Ÿà¥€, à¤–à¤¾à¤¦, à¤•à¥€à¤¡à¤¼à¥‡-à¤®à¤•à¥‹à¤¡à¤¼à¥‡ à¤¨à¤¿à¤¯à¤‚à¤¤à¥à¤°à¤£, à¤¯à¤¾ à¤•à¤¿à¤¸à¥€ à¤­à¥€ à¤–à¥‡à¤¤à¥€ à¤¸à¤‚à¤¬à¤‚à¤§à¥€ à¤ªà¥à¤°à¤¶à¥à¤¨ à¤ªà¥‚à¤›à¥‡à¤‚à¥¤ à¤®à¥ˆà¤‚ à¤†à¤ªà¤•à¥‡ à¤ªà¥Œà¤§à¥‹à¤‚ à¤¯à¤¾ à¤®à¤¿à¤Ÿà¥à¤Ÿà¥€ à¤•à¥€ à¤¤à¤¸à¥à¤µà¥€à¤°à¥‹à¤‚ à¤•à¤¾ à¤µà¤¿à¤¶à¥à¤²à¥‡à¤·à¤£ à¤­à¥€ à¤•à¤° à¤¸à¤•à¤¤à¤¾ à¤¹à¥‚à¤‚!',
            'bn': 'à¦¨à¦®à¦¸à§à¦•à¦¾à¦°! à¦†à¦®à¦¿ à¦†à¦ªà¦¨à¦¾à¦° AI à¦•à§ƒà¦·à¦¿ à¦¸à¦¹à¦¾à¦¯à¦¼à¦•à¥¤ à¦†à¦®à¦¾à¦•à§‡ à¦«à¦¸à¦², à¦®à¦¾à¦Ÿà¦¿, à¦¸à¦¾à¦°, à¦•à§€à¦Ÿà¦ªà¦¤à¦™à§à¦— à¦¨à¦¿à¦¯à¦¼à¦¨à§à¦¤à§à¦°à¦£, à¦¬à¦¾ à¦•à§ƒà¦·à¦¿ à¦¸à¦®à§à¦ªà¦°à§à¦•à¦¿à¦¤ à¦¯à§‡à¦•à§‹à¦¨à§‹ à¦ªà§à¦°à¦¶à§à¦¨ à¦•à¦°à§à¦¨à¥¤ à¦†à¦®à¦¿ à¦†à¦ªà¦¨à¦¾à¦° à¦—à¦¾à¦› à¦¬à¦¾ à¦®à¦¾à¦Ÿà¦¿à¦° à¦›à¦¬à¦¿à¦“ à¦¬à¦¿à¦¶à§à¦²à§‡à¦·à¦£ à¦•à¦°à¦¤à§‡ à¦ªà¦¾à¦°à¦¿!',
            'te': 'à°¨à°®à°¸à±à°•à°¾à°°à°‚! à°¨à±‡à°¨à± à°®à±€ AI à°µà±à°¯à°µà°¸à°¾à°¯ à°¸à°¹à°¾à°¯à°•à±à°¡à°¨à±. à°ªà°‚à°Ÿà°²à±, à°®à°Ÿà±à°Ÿà°¿, à°Žà°°à±à°µà±à°²à±, à°•à±€à°Ÿà°•à°¾à°² à°¨à°¿à°¯à°‚à°¤à±à°°à°£ à°²à±‡à°¦à°¾ à°µà±à°¯à°µà°¸à°¾à°¯ à°¸à°‚à°¬à°‚à°§à°¿à°¤ à°à°µà±ˆà°¨à°¾ à°ªà±à°°à°¶à±à°¨à°²à± à°…à°¡à°—à°‚à°¡à°¿à¥¤ à°®à±€ à°®à±Šà°•à±à°•à°²à± à°²à±‡à°¦à°¾ à°®à°Ÿà±à°Ÿà°¿ à°šà°¿à°¤à±à°°à°¾à°²à°¨à± à°•à±‚à°¡à°¾ à°µà°¿à°¶à±à°²à±‡à°·à°¿à°‚à°šà°—à°²à°¨à±!',
            'ta': 'à®µà®£à®•à¯à®•à®®à¯! à®¨à®¾à®©à¯ à®‰à®™à¯à®•à®³à¯ AI à®µà®¿à®µà®šà®¾à®¯ à®‰à®¤à®µà®¿à®¯à®¾à®³à®°à¯. à®ªà®¯à®¿à®°à¯à®•à®³à¯, à®®à®£à¯, à®‰à®°à®™à¯à®•à®³à¯, à®ªà¯‚à®šà¯à®šà®¿ à®•à®Ÿà¯à®Ÿà¯à®ªà¯à®ªà®¾à®Ÿà¯ à®…à®²à¯à®²à®¤à¯ à®µà®¿à®µà®šà®¾à®¯à®®à¯ à®¤à¯Šà®Ÿà®°à¯à®ªà®¾à®© à®Žà®¨à¯à®¤ à®•à¯‡à®³à¯à®µà®¿à®•à®³à¯ˆà®¯à¯à®®à¯ à®Žà®©à¯à®©à®¿à®Ÿà®®à¯ à®•à¯‡à®³à¯à®™à¯à®•à®³à¯. à®‰à®™à¯à®•à®³à¯ à®¤à®¾à®µà®°à®™à¯à®•à®³à¯ à®…à®²à¯à®²à®¤à¯ à®®à®£à¯ à®ªà®Ÿà®™à¯à®•à®³à¯ˆà®¯à¯à®®à¯ à®ªà®•à¯à®ªà¯à®ªà®¾à®¯à¯à®µà¯ à®šà¯†à®¯à¯à®¯ à®®à¯à®Ÿà®¿à®¯à¯à®®à¯!',
            'mr': 'à¤¨à¤®à¤¸à¥à¤•à¤¾à¤°! à¤®à¥€ à¤¤à¥à¤®à¤šà¤¾ AI à¤¶à¥‡à¤¤à¥€ à¤¸à¤¹à¤¾à¤¯à¥à¤¯à¤• à¤†à¤¹à¥‡. à¤ªà¤¿à¤•à¥‡, à¤®à¤¾à¤¤à¥€, à¤–à¤¤à¥‡, à¤•à¤¿à¤¡ à¤¨à¤¿à¤¯à¤‚à¤¤à¥à¤°à¤£ à¤•à¤¿à¤‚à¤µà¤¾ à¤¶à¥‡à¤¤à¥€à¤µà¤¿à¤·à¤¯à¤• à¤•à¥‹à¤£à¤¤à¥‡à¤¹à¥€ à¤ªà¥à¤°à¤¶à¥à¤¨ à¤µà¤¿à¤šà¤¾à¤°à¤¾. à¤®à¥€ à¤¤à¥à¤®à¤šà¥à¤¯à¤¾ à¤µà¤¨à¤¸à¥à¤ªà¤¤à¥€ à¤•à¤¿à¤‚à¤µà¤¾ à¤®à¤¾à¤¤à¥€à¤šà¥à¤¯à¤¾ à¤ªà¥à¤°à¤¤à¤¿à¤®à¤¾à¤‚à¤šà¥‡ à¤µà¤¿à¤¶à¥à¤²à¥‡à¤·à¤£ à¤¦à¥‡à¤–à¥€à¤² à¤•à¤°à¥‚ à¤¶à¤•à¤¤à¥‹!',
            'gu': 'àª¨àª®àª¸à«àª¤à«‡! àª¹à«àª‚ àª¤àª®àª¾àª°à«‹ AI àª•à«ƒàª·àª¿ àª¸àª¹àª¾àª¯àª• àª›à«àª‚. àªªàª¾àª•à«‹, àª®àª¾àªŸà«€, àª–àª¾àª¤àª°, àªœàª‚àª¤à« àª¨àª¿àª¯àª‚àª¤à«àª°àª£ àª…àª¥àªµàª¾ àª•à«ƒàª·àª¿ àª¸àª‚àª¬àª‚àª§àª¿àª¤ àª•à«‹àªˆàªªàª£ àªªà«àª°àª¶à«àª¨à«‹ àªªà«‚àª›à«‹. àª¹à«àª‚ àª¤àª®àª¾àª°àª¾ àª›à«‹àª¡ àª…àª¥àªµàª¾ àª®àª¾àªŸà«€àª¨à«€ àª›àª¬à«€àª“àª¨à«àª‚ àªµàª¿àª¶à«àª²à«‡àª·àª£ àªªàª£ àª•àª°à«€ àª¶àª•à«àª‚ àª›à«àª‚!',
            'kn': 'à²¨à²®à²¸à³à²•à²¾à²°! à²¨à²¾à²¨à³ à²¨à²¿à²®à³à²® AI à²•à³ƒà²·à²¿ à²¸à²¹à²¾à²¯à²•. à²¬à³†à²³à³†à²—à²³à³, à²®à²£à³à²£à³, à²—à³Šà²¬à³à²¬à²°, à²•à³€à²Ÿ à²¨à²¿à²¯à²‚à²¤à³à²°à²£ à²…à²¥à²µà²¾ à²•à³ƒà²·à²¿ à²¸à²‚à²¬à²‚à²§à²¿à²¤ à²¯à²¾à²µà³à²¦à³‡ à²ªà³à²°à²¶à³à²¨à³†à²—à²³à²¨à³à²¨à³ à²•à³‡à²³à²¿. à²¨à²¾à²¨à³ à²¨à²¿à²®à³à²® à²¸à²¸à³à²¯à²—à²³à³ à²…à²¥à²µà²¾ à²®à²£à³à²£à²¿à²¨ à²šà²¿à²¤à³à²°à²—à²³à²¨à³à²¨à³ à²¸à²¹ à²µà²¿à²¶à³à²²à³‡à²·à²¿à²¸à²¬à²²à³à²²à³†!',
            'ml': 'à´¨à´®à´¸àµà´•à´¾à´°à´‚! à´žà´¾àµ» à´¨à´¿à´™àµà´™à´³àµà´Ÿàµ† AI à´•à´¾àµ¼à´·à´¿à´• à´¸à´¹à´¾à´¯à´•à´¨à´¾à´£àµ. à´µà´¿à´³à´•àµ¾, à´®à´£àµà´£àµ, à´µà´³à´‚, à´•àµ€à´Ÿ à´¨à´¿à´¯à´¨àµà´¤àµà´°à´£à´‚ à´…à´²àµà´²àµ†à´™àµà´•à´¿àµ½ à´•à´¾àµ¼à´·à´¿à´• à´µà´¿à´·à´¯à´™àµà´™à´³àµ†à´•àµà´•àµà´±à´¿à´šàµà´šàµ à´Žà´¨àµà´¤àµ†à´™àµà´•à´¿à´²àµà´‚ à´šàµ‹à´¦àµà´¯à´™àµà´™àµ¾ à´šàµ‹à´¦à´¿à´•àµà´•àµà´•. à´¨à´¿à´™àµà´™à´³àµà´Ÿàµ† à´šàµ†à´Ÿà´¿à´•à´³àµà´Ÿàµ†à´¯àµ‹ à´®à´£àµà´£à´¿à´¨àµà´±àµ†à´¯àµ‹ à´šà´¿à´¤àµà´°à´™àµà´™àµ¾ à´µà´¿à´¶à´•à´²à´¨à´‚ à´šàµ†à´¯àµà´¯à´¾à´¨àµà´‚ à´Žà´¨à´¿à´•àµà´•àµ à´•à´´à´¿à´¯àµà´‚!',
            'pa': 'à¨¸à¨¤ à¨¸à©à¨°à©€ à¨…à¨•à¨¾à¨²! à¨®à©ˆà¨‚ à¨¤à©à¨¹à¨¾à¨¡à¨¾ AI à¨–à©‡à¨¤à©€à¨¬à¨¾à©œà©€ à¨¸à¨¹à¨¾à¨‡à¨• à¨¹à¨¾à¨‚à¥¤ à¨«à¨¸à¨²à¨¾à¨‚, à¨®à¨¿à©±à¨Ÿà©€, à¨–à¨¾à¨¦, à¨•à©€à©œà©‡-à¨®à¨•à©Œà©œà©‡ à¨¨à¨¿à¨¯à©°à¨¤à¨°à¨£, à¨œà¨¾à¨‚ à¨–à©‡à¨¤à©€à¨¬à¨¾à©œà©€ à¨¨à¨¾à¨² à¨¸à¨¬à©°à¨§à¨¤ à¨•à©‹à¨ˆ à¨µà©€ à¨¸à¨µà¨¾à¨² à¨ªà©à©±à¨›à©‹à¥¤ à¨®à©ˆà¨‚ à¨¤à©à¨¹à¨¾à¨¡à©‡ à¨ªà©Œà¨§à¨¿à¨†à¨‚ à¨œà¨¾à¨‚ à¨®à¨¿à©±à¨Ÿà©€ à¨¦à©€à¨†à¨‚ à¨¤à¨¸à¨µà©€à¨°à¨¾à¨‚ à¨¦à¨¾ à¨µà¨¿à¨¸à¨¼à¨²à©‡à¨¸à¨¼à¨£ à¨µà©€ à¨•à¨° à¨¸à¨•à¨¦à¨¾ à¨¹à¨¾à¨‚!',
            'or': 'à¬¨à¬®à¬¸à­à¬•à¬¾à¬°! à¬®à­à¬ à¬†à¬ªà¬£à¬™à­à¬•à¬° AI à¬•à­ƒà¬·à¬¿ à¬¸à¬¹à¬¾à­Ÿà¬•à¥¤ à¬«à¬¸à¬², à¬®à¬¾à¬Ÿà¬¿, à¬¸à¬¾à¬°, à¬•à­€à¬Ÿ à¬¨à¬¿à­Ÿà¬¨à­à¬¤à­à¬°à¬£ à¬•à¬¿à¬®à­à¬¬à¬¾ à¬•à­ƒà¬·à¬¿ à¬¸à¬®à­à¬¬à¬¨à­à¬§à­€à­Ÿ à¬¯à­‡à¬•à­Œà¬£à¬¸à¬¿ à¬ªà­à¬°à¬¶à­à¬¨ à¬ªà¬šà¬¾à¬°à¬¨à­à¬¤à­à¥¤ à¬®à­à¬ à¬†à¬ªà¬£à¬™à­à¬• à¬‰à¬¦à­à¬­à¬¿à¬¦ à¬•à¬¿à¬®à­à¬¬à¬¾ à¬®à¬¾à¬Ÿà¬¿à¬° à¬šà¬¿à¬¤à­à¬°à¬—à­à¬¡à¬¼à¬¿à¬•à¬° à¬¬à¬¿à¬¶à­à¬³à­‡à¬·à¬£ à¬®à¬§à­à­Ÿ à¬•à¬°à¬¿à¬ªà¬¾à¬°à­‡!'
        };

        const message = welcomeMessages[language] || welcomeMessages['en'];

        // Update the welcome message in the chat
        const welcomeMessageContent = document.querySelector('#welcome-message .message-content');
        if (welcomeMessageContent) {
            welcomeMessageContent.innerHTML = `<i class="fas fa-robot" style="color: var(--primary); margin-right: 8px;"></i>${message}`;
        }

        // Update input placeholder based on language
        const placeholderTexts = {
            'en': 'Ask about farming, crops, soil, fertilizers...',
            'hi': 'à¤–à¥‡à¤¤à¥€, à¤«à¤¸à¤², à¤®à¤¿à¤Ÿà¥à¤Ÿà¥€, à¤–à¤¾à¤¦ à¤•à¥‡ à¤¬à¤¾à¤°à¥‡ à¤®à¥‡à¤‚ à¤ªà¥‚à¤›à¥‡à¤‚...',
            'bn': 'à¦•à§ƒà¦·à¦¿, à¦«à¦¸à¦², à¦®à¦¾à¦Ÿà¦¿, à¦¸à¦¾à¦° à¦¸à¦®à§à¦ªà¦°à§à¦•à§‡ à¦œà¦¿à¦œà§à¦žà¦¾à¦¸à¦¾ à¦•à¦°à§à¦¨...',
            'te': 'à°µà±à°¯à°µà°¸à°¾à°¯à°‚, à°ªà°‚à°Ÿà°²à±, à°®à°Ÿà±à°Ÿà°¿, à°Žà°°à±à°µà±à°² à°—à±à°°à°¿à°‚à°šà°¿ à°…à°¡à°—à°‚à°¡à°¿...',
            'ta': 'à®µà®¿à®µà®šà®¾à®¯à®®à¯, à®ªà®¯à®¿à®°à¯à®•à®³à¯, à®®à®£à¯, à®‰à®°à®™à¯à®•à®³à¯ à®ªà®±à¯à®±à®¿ à®•à¯‡à®³à¯à®™à¯à®•à®³à¯...',
            'mr': 'à¤¶à¥‡à¤¤à¥€, à¤ªà¤¿à¤•à¥‡, à¤®à¤¾à¤¤à¥€, à¤–à¤¤à¥‡ à¤¬à¤¦à¥à¤¦à¤² à¤µà¤¿à¤šà¤¾à¤°à¤¾...',
            'gu': 'àª–à«‡àª¤à«€, àªªàª¾àª•à«‹, àª®àª¾àªŸà«€, àª–àª¾àª¤àª° àªµàª¿àª¶à«‡ àªªà«‚àª›à«‹...',
            'kn': 'à²•à³ƒà²·à²¿, à²¬à³†à²³à³†à²—à²³à³, à²®à²£à³à²£à³, à²—à³Šà²¬à³à²¬à²°à²¦ à²¬à²—à³à²—à³† à²•à³‡à²³à²¿...',
            'ml': 'à´•àµƒà´·à´¿, à´µà´¿à´³à´•àµ¾, à´®à´£àµà´£àµ, à´µà´³à´‚ à´Žà´¨àµà´¨à´¿à´µà´¯àµ†à´•àµà´•àµà´±à´¿à´šàµà´šàµ à´šàµ‹à´¦à´¿à´•àµà´•àµà´•...',
            'pa': 'à¨–à©‡à¨¤à©€, à¨«à¨¸à¨²à¨¾à¨‚, à¨®à¨¿à©±à¨Ÿà©€, à¨–à¨¾à¨¦ à¨¬à¨¾à¨°à©‡ à¨ªà©à©±à¨›à©‹...',
            'or': 'à¬•à­ƒà¬·à¬¿, à¬«à¬¸à¬², à¬®à¬¾à¬Ÿà¬¿, à¬¸à¬¾à¬° à¬¬à¬¿à¬·à­Ÿà¬°à­‡ à¬ªà¬šà¬¾à¬°à¬¨à­à¬¤à­...'
        };

        const chatInput = document.getElementById('chat-input');
        if (chatInput) {
            chatInput.placeholder = placeholderTexts[language] || placeholderTexts['en'];
        }
    }

    // Add message to chat
    function addChatMessage(message, isUser, image = null) {
        const chatMessages = document.getElementById('chat-messages');
        const messageDiv = document.createElement('div');
        messageDiv.className = `chat-message ${isUser ? 'user-message' : 'bot-message'}`;

        let imageHtml = '';
        if (image && isUser) {
            const imageUrl = URL.createObjectURL(image);
            imageHtml = `<div style="margin-bottom: 8px;"><img src="${imageUrl}" alt="Uploaded image" style="max-width: 200px; max-height: 150px; border-radius: 8px;"></div>`;
        }

        const icon = isUser ? '<i class="fas fa-user" style="color: white; margin-right: 8px;"></i>' :
                            '<i class="fas fa-robot" style="color: var(--primary); margin-right: 8px;"></i>';

        messageDiv.innerHTML = `
            <div class="message-content">
                ${imageHtml}
                ${icon}${message}
            </div>
        `;

        chatMessages.appendChild(messageDiv);
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    // Show typing indicator
    function showTypingIndicator() {
        const chatMessages = document.getElementById('chat-messages');
        const typingDiv = document.createElement('div');
        typingDiv.className = 'typing-indicator';
        typingDiv.id = 'typing-indicator';
        typingDiv.innerHTML = '<i class="fas fa-robot" style="color: var(--primary); margin-right: 8px;"></i>AI Assistant is thinking<span class="typing-dots"></span>';

        chatMessages.appendChild(typingDiv);
        typingDiv.style.display = 'block';
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    // Hide typing indicator
    function hideTypingIndicator() {
        const typingIndicator = document.getElementById('typing-indicator');
        if (typingIndicator) {
            typingIndicator.remove();
        }
    }

    function handleWeatherForm(e) {
        e.preventDefault();
        const city = document.getElementById('weather-city').value.trim();

        if (!city) {
            alert('Please enter a city name');
            return;
        }

        getWeatherForCity(city);
    }

    // Initialize weather widget
    function initializeWeatherWidget() {
        // Update weather every 10 minutes for authenticated users
        setInterval(() => {
            if (accessToken && userCity) {
                loadWeatherForCity(userCity);
            }
        }, 60000000); // 10 minutes

        // Initial weather load
        setTimeout(() => {
            if (userCity) {
                loadWeatherForCity(userCity);
            } else {
                loadWeatherForCity('Delhi'); // Default city
            }
        }, 1000);
    }

    // Global functions for form interactions
    window.showLoginForm = showLoginForm;
    window.showSignupForm = showSignupForm;
    window.signup = signup;
    window.sendOtp = sendOtp;
    window.verifyOtp = verifyOtp;
    window.resendOtp = resendOtp;
    window.logout = logout;
    window.updateWelcomeMessage = updateWelcomeMessage;
    window.toggleAnalysisMethod = toggleAnalysisMethod;
    window.previewImage = previewImage;
    window.removeImage = removeImage;

    const equipmentData = [
            {
                name: "Tractor",
                price: "â‚¹8,50,000",
                description: "Heavy duty agricultural tractor with advanced features",
                category: "tractor",
                emoji: "ðŸšœ"
            },
            {
                name: "Combine Harvester",
                price: "â‚¹25,00,000",
                description: "Multi purpose harvester for efficient crop collection",
                category: "harvester",
                emoji: "ðŸŒ¾"
            },
            {
                name: "Plough",
                price: "â‚¹15,000",
                description: "Essential tool for breaking and turning soil",
                category: "tools",
                emoji: "ðŸª“"
            },
            {
                name: "Seed Drill",
                price: "â‚¹45,000",
                description: "Precision planting equipment for optimal seed placement",
                category: "tools",
                emoji: "ðŸŒ±"
            },
            {
                name: "Cultivator",
                price: "â‚¹35,000",
                description: "Secondary tillage tool for soil preparation",
                category: "tools",
                emoji: "âš’ï¸"
            },
            {
                name: "Harrow",
                price: "â‚¹28,000",
                description: "Soil preparation tool for smoothing and breaking clods",
                category: "tools",
                emoji: "ðŸ”§"
            },
            {
                name: "Sprayer",
                price: "â‚¹65,000",
                description: "Equipment for applying pesticides and fertilizers",
                category: "tools",
                emoji: "ðŸ’¨"
            },
            {
                name: "Rotavator",
                price: "â‚¹55,000",
                description: "Rotary tiller for soil preparation and mixing",
                category: "tools",
                emoji: "âš™ï¸"
            },
            {
                name: "Thresher",
                price: "â‚¹85,000",
                description: "Machine for separating grain from harvested crops",
                category: "harvester",
                emoji: "ðŸŒ¾"
            },
            {
                name: "Water Pump",
                price: "â‚¹12,000",
                description: "Essential irrigation equipment for water supply",
                category: "tools",
                emoji: "ðŸ’§"
            },
            {
                name: "Mower",
                price: "â‚¹42,000",
                description: "Cutting equipment for grass and crop maintenance",
                category: "tools",
                emoji: "âœ‚ï¸"
            },
            {
                name: "Transplanter",
                price: "â‚¹75,000",
                description: "Specialized machine for transplanting seedlings",
                category: "tools",
                emoji: "ðŸŒ¿"
            }
        ];

        let currentFilter = 'all';

        function loadEquipment(filter = 'all', searchTerm = '') {
            const grid = document.getElementById('equipmentGrid');
            grid.innerHTML = '';
            
            const filteredData = equipmentData.filter(item => {
                const matchesFilter = filter === 'all' || item.category === filter;
                const matchesSearch = item.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                                    item.description.toLowerCase().includes(searchTerm.toLowerCase());
                return matchesFilter && matchesSearch;
            });

            filteredData.forEach((equipment, index) => {
                setTimeout(() => {
                    const card = createEquipmentCard(equipment);
                    grid.appendChild(card);
                }, index * 100);
            });
        }

        function createEquipmentCard(equipment) {
            const card = document.createElement('div');
            card.className = 'equipment-card';
            card.style.animationDelay = '0s';
            
            card.innerHTML = `
                <div class="equipment-image">
                    ${equipment.emoji}
                </div>
                <div class="equipment-info">
                    <h3>${equipment.name}</h3>
                    <div class="equipment-price">${equipment.price}</div>
                    <p class="equipment-desc">${equipment.description}</p>
                    <button class="view-details-btn" onclick="viewDetails('${equipment.name}')">
                        View Details
                    </button>
                </div>
            `;
            
            return card;
        }

        function filterBy(category) {
            currentFilter = category;
            
            // Update active button
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Add loading effect
            const grid = document.getElementById('equipmentGrid');
            grid.classList.add('loading');
            
            setTimeout(() => {
                loadEquipment(category, document.getElementById('searchBox').value);
                grid.classList.remove('loading');
            }, 300);
        }

        function viewDetails(equipmentName) {
            // Simulate navigation or modal opening
            alert(`Viewing details for: ${equipmentName}\n\nThis would typically open a detailed product page with specifications, images, and purchase options.`);
        }

        function goBack() {
            if (window.history.length > 1) {
                window.history.back();
            } else {
                alert('Going back to main menu');
            }
        }

        // Search functionality
        document.getElementById('searchBox').addEventListener('input', function(e) {
            const searchTerm = e.target.value;
            loadEquipment(currentFilter, searchTerm);
        });

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            loadEquipment();
        });

        // Add some interactive hover effects
        document.addEventListener('mouseover', function(e) {
            if (e.target.classList.contains('equipment-card')) {
                e.target.style.transform = 'translateY(-8px) scale(1.02)';
            }
        });

        document.addEventListener('mouseout', function(e) {
            if (e.target.classList.contains('equipment-card')) {
                e.target.style.transform = 'translateY(-5px) scale(1)';
            }
        });

</script> 
</body>
</html>